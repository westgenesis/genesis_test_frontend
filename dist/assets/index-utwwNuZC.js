import{d as e,a as l,E as t,b as a,u as i,c as s,r,s as n,e as o,w as d,o as u,f as c,g as p,h as v,i as m,j as _,k as f,F as g,l as h,m as y,n as b,p as w,q as x,t as j,v as q,U as k,x as C,y as $,z as R,M as U,C as I,S as P,A as B,B as T,D,G as S,H as z,I as F,J as O,K as V,L,R as M,N as E,Q as A,O as N,P as K,T as Y,V as H,W as J,X as W,Y as G,Z as Q,_ as X,$ as Z,a0 as ee,a1 as le,a2 as te,a3 as ae,a4 as ie,a5 as se,a6 as re}from"./.pnpm-CF4MJxFQ.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&l(e)})).observe(document,{childList:!0,subtree:!0})}function l(e){if(e.ep)return;e.ep=!0;const l=function(e){const l={};return e.integrity&&(l.integrity=e.integrity),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?l.credentials="include":"anonymous"===e.crossOrigin?l.credentials="omit":l.credentials="same-origin",l}(e);fetch(e.href,l)}}();const ne="/assets/logo-Crj9fBJW.svg",oe=e("user",{state:()=>({name:"",email:""}),actions:{updateName(e){this.name=e},updateEmail(e){this.email=e}}}),de=l.create({baseURL:"/dev-api",timeout:6e4});de.interceptors.request.use((e=>{const l=localStorage.getItem("token");return l&&(e.headers.Authorization="Bearer "+l),[e.params,e.data].forEach((e=>{for(const l in e)l.startsWith("_")&&delete e[l]})),e}),(e=>Promise.reject(e))),de.interceptors.response.use((e=>500===e.status?(t.error(e.data.message),Promise.reject(e)):e.data),(e=>(401===e.response.status&&(t.error("未授权，请重新登录"),window.location.href="#/login"),Promise.reject(e))));const ue=e("project",{state:()=>({projects:JSON.parse(localStorage.getItem("projects")||"[]")||[],currentProject:{_id:{}}}),actions:{updateProjects(e){this.projects=e,localStorage.setItem("projects",JSON.stringify(e))},updateCurrentProject(e){this.currentProject=e},updateCurrentProjectById(e){this.currentProject=this.projects.find((l=>l._id.$oid===e))},async refreshProject(e){const l=await de.get(`/api/project_info/${e}`);this.currentProject=l.project_data},async refreshAllProjects(){return await de.get("/api/display_user_projects",{}).then((e=>(this.updateProjects(e.data),e.data)))}}}),ce={key:0,class:"minh-[60px] flex bg-custom-bg justify-between items-center"},pe={class:"flex items-center"},ve={class:"h-full flex ml-[16px]"},me=["src"],_e={class:"h-full"},fe=(e=>(C("data-v-bb9b6844"),e=e(),$(),e))((()=>v("div",{class:"ml-[10px]"},null,-1))),ge={class:"h-full flex items-center"},he=["onClick"],ye={class:"right mr-[16px] min-w-[150px] cursor-pointer"},be=(e,l)=>{const t=e.__vccOpts||e;for(const[a,i]of l)t[a]=i;return t},we=be(a({__name:"TopBar",setup(e){const l=i(),t=s(),a=r(""),C=oe(),{email:$}=n(C),R=ue(),{projects:U,currentProject:I}=n(R),P=o((()=>"/login"===l.path||"/registry"===l.path)),B=r("项目管理"),T=[{name:"项目管理",to:"/project/projectManage"},{name:"需求管理",to:"/requirement/functionPoints"},{name:"用例管理",to:"/usecase/usecaseManage"}],D=()=>{t.push("/login")};d(U,(e=>{e.length>0&&(a.value=e[0]._id.$oid)}),{immediate:!0});const S=e=>{const l=U.value.find((l=>l._id.$oid===e));l&&(R.updateCurrentProjectById(e),I.value.name=l.name)};return u((()=>{const e=location.hash.replace("#","");e.startsWith("/project")?B.value="项目管理":e.startsWith("/requirement")?B.value="需求管理":B.value="用例管理"})),(e,l)=>{const i=b("a-select-option"),s=b("a-select"),r=b("a-menu-item"),n=b("a-menu"),o=b("a-dropdown");return P.value?y("",!0):(c(),p("div",ce,[v("div",pe,[v("div",ve,[v("img",{src:m(ne)},null,8,me)]),v("div",_e,[_(s,{ref:"select",value:a.value,"onUpdate:value":l[0]||(l[0]=e=>a.value=e),style:{width:"12rem","margin-top":"2px","margin-left":"16px"},class:"mt-[12px]",onChange:S},{default:f((()=>[(c(!0),p(g,null,h(m(U),(e=>(c(),w(i,{key:e._id.$oid,value:e._id.$oid},{default:f((()=>[x(j(e.name),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])]),fe,v("div",ge,[(c(),p(g,null,h(T,(e=>v("div",{key:e.name,class:q(["p-[10px] topBarItem cursor-pointer",{"bg-white":e.name===B.value}]),onClick:l=>(async e=>{B.value=e.name,await R.refreshAllProjects(),t.replace(e.to||"/")})(e)},j(e.name),11,he))),64))])]),_(o,null,{overlay:f((()=>[_(n,null,{default:f((()=>[_(r,{onClick:D},{default:f((()=>[x(" 退出登录 ")])),_:1})])),_:1})])),default:f((()=>[v("div",ye,[_(m(k),{class:"ml-[10px]"}),x(j(m($)||"游客"),1)])])),_:1})]))}}}),[["__scopeId","data-v-bb9b6844"]]),xe={class:"main"},je={class:"flex flex-1",style:{overflow:"hidden"}},qe={class:"flex-1",style:{"background-color":"#fff",overflow:"hidden"}},ke=be(a({__name:"App",setup(e){const l=ue(),t=oe();return u((()=>{localStorage.getItem("email")&&t.updateEmail(localStorage.getItem("email")),de.get("/api/display_user_projects",{}).then((e=>(l.updateProjects(e.data),l.updateCurrentProject(e.data[0]),{data:e.data,total:e.total})))})),(e,l)=>{const t=b("router-view");return c(),p("div",xe,[_(we),v("div",je,[v("div",qe,[_(t)])])])}}}),[["__scopeId","data-v-0ed67e99"]]),Ce=e=>(C("data-v-794b449d"),e=e(),$(),e),$e={class:"login-form",style:{height:"100vh"}},Re={class:"form mt-[32px] min-w-[480px]"},Ue={class:"title"},Ie={class:"flex justify-center"},Pe=["src"],Be=Ce((()=>v("div",{class:"title-0 m-[16px] flex justify-center"},[v("span",{class:"title-welcome one-line-text max-w-[300px]"}," 现代化的测试和用例管理工具 ")],-1))),Te={class:"a-form"},De={class:"login-form-item"},Se={class:"login-form-item"},ze={class:"flex"},Fe={class:"mb-[20px] mt-[12px] flex-center"},Oe={class:"flex-center mt-[20px]"},Ve=Ce((()=>v("span",{class:"mr-1"},"还没有账号？",-1))),Le={class:"mt-4 flex items-center justify-center"},Me={class:"loginType"},Ee=be(a({__name:"Login",props:{msg:{}},setup(e){const l=s(),a=r(""),i=r(""),n=r(!0),o=oe(),d=async()=>{const e={email:a.value,password:i.value,remember_me:n.value};try{const a=await de.post("/auth/login",e);"success"===a.status?(window.localStorage.setItem("email",e.email),e.remember_me?window.localStorage.setItem("password",e.password):window.localStorage.removeItem("password"),window.localStorage.setItem("token",a.access_token),o.updateEmail(e.email),l.replace("/project/projectManage")):t.error("登录失败")}catch(s){}};return u((()=>{const e=window.localStorage.getItem("email"),l=window.localStorage.getItem("password");e&&(a.value=e),e&&l&&(i.value=l)})),(e,l)=>{const t=b("el-input"),s=b("el-checkbox"),r=b("el-button"),o=b("router-link"),u=b("svg-icon");return c(),p("div",$e,[v("div",Re,[v("div",Ue,[v("div",Ie,[v("img",{src:m(ne),class:"h-[60px] w-[290px]"},null,8,Pe)]),Be]),v("form",Te,[v("div",De,[_(t,{class:"login-input","max-length":"64",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),size:"large",placeholder:"请输入邮箱"},null,8,["modelValue"])]),v("div",Se,[_(t,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e),type:"password",class:"login-password-input",placeholder:"请输入密码",size:"large",onKeydown:R(d,["enter"])},null,8,["modelValue"])]),v("div",ze,[_(s,{modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value=e),label:"记住密码"},null,8,["modelValue"])]),v("div",Fe,[_(r,{type:"button",class:"a-button primary large",long:"",onClick:d},{default:f((()=>[x(" 登陆 ")])),_:1})]),v("div",Oe,[Ve,_(o,{class:"no-drag text-[#DB22D9]",to:"/registry"},{default:f((()=>[x("注册")])),_:1})])]),v("div",Le,[v("div",Me,[_(u,{name:"scan_code",width:"18px",height:"18px",class:"text-[rgb(var(--primary-6))]"})])])])])}}}),[["__scopeId","data-v-794b449d"]]),Ae=e=>(C("data-v-603cd192"),e=e(),$(),e),Ne={class:"login-form",style:{height:"100vh"}},Ke={class:"form mt-[32px] min-w-[480px]"},Ye={class:"title"},He={class:"flex justify-center"},Je=["src"],We=Ae((()=>v("div",{class:"title-0 m-[16px] flex justify-center"},[v("span",{class:"title-welcome one-line-text max-w-[300px]"}," 现代化的测试和用例管理工具 ")],-1))),Ge={class:"a-form"},Qe={class:"login-form-item"},Xe={class:"login-form-item"},Ze={class:"login-form-item"},el={class:"login-form-item"},ll={class:"mb-[10px] mt-[12px] flex-center"},tl={class:"flex-center mt-[20px]"},al=Ae((()=>v("span",{class:"mr-2"},"已有账号",-1))),il={class:"mt-4 flex items-center justify-center"},sl={class:"loginType"},rl=be(a({__name:"Registry",props:{msg:{}},setup(e){const l=s(),a=r(""),i=r(""),n=r(""),o=r(""),d=async()=>{const e={username:a.value,email:i.value,password:n.value,passowrd2:o.value,affiliation:""};try{const a=await de.post("/auth/register",e);"success"===a.status?(l.replace("/login").then((()=>{})),t.success(a.message)):t.error(a.message)}catch(s){}};return(e,l)=>{const t=b("el-input"),s=b("el-button"),r=b("router-link"),u=b("svg-icon");return c(),p("div",Ne,[v("div",Ke,[v("div",Ye,[v("div",He,[v("img",{src:m(ne),class:"h-[60px] w-[290px]"},null,8,Je)]),We]),v("form",Ge,[v("div",Qe,[_(t,{class:"login-input","max-length":"64",modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),size:"large",placeholder:"请输入用户名"},null,8,["modelValue"])]),v("div",Xe,[_(t,{class:"login-input","max-length":"64",modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e),size:"large",placeholder:"请输入邮箱"},null,8,["modelValue"])]),v("div",Ze,[_(t,{modelValue:n.value,"onUpdate:modelValue":l[2]||(l[2]=e=>n.value=e),type:"password",class:"login-password-input",placeholder:"请输入密码",size:"large"},null,8,["modelValue"])]),v("div",el,[_(t,{modelValue:o.value,"onUpdate:modelValue":l[3]||(l[3]=e=>o.value=e),type:"password",class:"login-password-input",placeholder:"请再次输入密码",size:"large"},null,8,["modelValue"])]),v("div",ll,[_(s,{type:"button",class:"a-button primary large",long:"",onClick:d},{default:f((()=>[x(" 注册 ")])),_:1})]),v("div",tl,[al,_(r,{class:"no-drag text-[#DB22D9]",to:"/login"},{default:f((()=>[x("登录")])),_:1})])]),v("div",il,[v("div",sl,[_(u,{name:"scan_code",width:"18px",height:"18px",class:"text-[rgb(var(--primary-6))]"})])])])])}}}),[["__scopeId","data-v-603cd192"]]),nl={"-1":{label:"全部",icon:U,color:"default"},0:{label:"未开始",icon:I,color:"default"},1:{label:"进行中",icon:P,color:"processing"},2:{label:"已完成",icon:B,color:"success"},3:{label:"已关闭",icon:T,color:"error"}},ol={class:"project-detail"},dl={class:"flex justify-end mr-[6rem] mb-[2rem]"},ul="YYYY/MM/DD",cl=be(a({__name:"ProjectDetail",props:{project:{type:Object,required:!0}},setup(e){const l=e,t=r(),a=r([D(l.project.period_start,ul),D(l.project.period_end,ul)]),i=r(!1),s=r(l.project.file_list),n=Object.keys(nl).reduce(((e,l)=>("-1"!==l&&(e[l]=nl[l]),e)),{}),o=()=>{i.value=!i.value};d((()=>l.project),(e=>{e.period_start&&e.period_end&&(a.value=[D(e.period_start,ul),D(e.period_end,ul)]),s.value=e.file_list,i.value=!1}),{immediate:!0,deep:!1});const u=r({dateFrom:l.project.period_start,dateTo:l.project.period_end}),y=(e,l)=>{(null==l?void 0:l.length)&&(u.value.dateFrom=l[0],u.value.dateTo=l[1])},q=()=>{const{project:e}=l,t={name:e.name,notes:e.description||"",periodStart:u.value.dateFrom,periodEnd:u.value.dateTo,kind:e.kind,project_id:e._id.$oid,project_status:e.project_status};de.put("/api/update_project",t).then((e=>{O.success("修改项目成功")})).catch((e=>{O.error("修改项目失败")}))},k=async e=>{var t,a;const i=new FormData,s=new Blob([JSON.stringify({db_id:null==(a=null==(t=l.project)?void 0:t._id)?void 0:a.$oid,category:"knowledges_update"})]);i.append("user_file",e.raw),i.append("info",s),await de.post("/api/upload_project_file",i)};return(r,d)=>{const u=b("a-button"),C=b("a-input"),$=b("a-form-item"),R=b("a-textarea"),U=b("a-range-picker"),I=b("a-select-option"),P=b("a-select"),B=b("el-button"),T=b("el-upload"),D=b("a-form");return c(),p("div",ol,[v("div",dl,[S(_(u,{type:"primary",onClick:o,class:"custom-purple-button"},{default:f((()=>[x("编辑")])),_:1},512),[[z,!i.value]]),S(_(u,{type:"primary",onClick:q,class:"custom-purple-button"},{default:f((()=>[x("确定")])),_:1},512),[[z,i.value]]),S(_(u,{type:"primary",onClick:o,class:"ml-[1rem] custom-purple-button"},{default:f((()=>[x("取消")])),_:1},512),[[z,i.value]])]),_(D,{model:e.project,"label-col":{span:6},"wrapper-col":{span:18},ref_key:"formRef",ref:t},{default:f((()=>[_($,{label:"项目编号",class:"form-item-spacing"},{default:f((()=>[_(C,{value:e.project.display_id,"onUpdate:value":d[0]||(d[0]=l=>e.project.display_id=l),disabled:!0,style:{width:"16.5rem"}},null,8,["value"])])),_:1}),_($,{label:"项目名称",class:"form-item-spacing"},{default:f((()=>[_(C,{value:e.project.name,"onUpdate:value":d[1]||(d[1]=l=>e.project.name=l),disabled:!i.value,style:{width:"16.5rem"}},null,8,["value","disabled"])])),_:1}),_($,{label:"测试环境",class:"form-item-spacing"},{default:f((()=>[_(C,{value:e.project.kind,"onUpdate:value":d[2]||(d[2]=l=>e.project.kind=l),disabled:!i.value,style:{width:"16.5rem"}},null,8,["value","disabled"])])),_:1}),_($,{label:"项目描述",class:"form-item-spacing"},{default:f((()=>[_(R,{value:e.project.description,"onUpdate:value":d[3]||(d[3]=l=>e.project.description=l),disabled:!i.value,style:{width:"16.5rem"}},null,8,["value","disabled"])])),_:1}),_($,{label:"计划周期",class:"form-item-spacing"},{default:f((()=>[_(U,{value:a.value,"onUpdate:value":d[4]||(d[4]=e=>a.value=e),disabled:!i.value,onChange:y},null,8,["value","disabled"])])),_:1}),_($,{label:"项目状态",class:"form-item-spacing"},{default:f((()=>[_(P,{value:e.project.project_status,"onUpdate:value":d[5]||(d[5]=l=>e.project.project_status=l),disabled:!i.value,style:{width:"16.5rem"}},{default:f((()=>[(c(!0),p(g,null,h(m(n),((e,l)=>(c(),w(I,{key:l,value:l},{default:f((()=>[x(j(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value","disabled"])])),_:1}),_($,{label:"知识库"},{default:f((()=>[(c(!0),p(g,null,h(s.value,(e=>(c(),p("div",{key:e},[x(j(e)+" ",1),_(u,{type:"link",onClick:t=>{return a=e,void de.post("/api/get_document",{project_id:l.project._id.$oid,object_name:l.project._id.$oid+"/"+a},{responseType:"blob"}).then((e=>{const l=new Blob([e],{type:"application/octet-stream"}),t=window.URL.createObjectURL(l),i=document.createElement("a");i.href=t,i.setAttribute("download",a),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(t)})).catch((e=>{}));var a}},{default:f((()=>[_(m(F))])),_:2},1032,["onClick"])])))),128)),_(T,{ref:"uploadRef","auto-upload":!1,"on-change":k,accept:".doc,.docx,.pdf,.xlsx,.png"},{trigger:f((()=>[_(B,null,{default:f((()=>[x(" 上传文件 ")])),_:1})])),_:1},512)])),_:1})])),_:1},8,["model"])])}}}),[["__scopeId","data-v-02c68b14"]]),pl={class:"m-[2rem]"},vl={class:"flex mb-[16px] items-center justify-between"},ml={class:"flex items-center"},_l={class:"ml-[20px]"},fl={class:"flex items-center"},gl={class:"ml-[5px]"},hl=be(a({__name:"ProjectManage",setup(e){const l=s(),t=Object.keys(nl).sort(((e,l)=>e-l)),a=ue(),i=[{title:"项目编号",dataIndex:"display_id",width:"10%"},{title:"项目名称",dataIndex:"name",sorter:!0,width:"25%"},{title:"计划周期",dataIndex:"period",width:"15%"},{title:"状态",dataIndex:"status",width:"10%"},{title:"更新时间",dataIndex:"time_modified",width:"15%"},{title:"测试环境",dataIndex:"kind",width:"10%"},{title:"操作",dataIndex:"actions",width:"20%"}],{data:n,run:o,loading:d}=V((e=>de.get("/api/display_user_projects",{params:e}).then((e=>(a.updateProjects(e.data),{data:e.data,total:e.total}))))),u=r("-1"),q=r(""),k=r([]),C=r(!1),$=r(null),R=()=>{o({search:q.value,status:"-1"===u.value?void 0:u.value})},U=()=>{l.replace("/project/addProject")},I=e=>{k.value=e},P=()=>{if(0===k.value.length)return void O.warning("请选择要删除的项目");const e=k.value;de.post("/api/delete_projects",{ids:e}).then((e=>{O.success("删除成功"),o()})).catch((e=>{O.error("删除失败")}))};return(e,s)=>{const r=b("el-radio-button"),o=b("el-radio-group"),B=b("a-input-search"),T=b("a-button"),D=b("a-tag"),S=b("a-table"),z=b("a-drawer");return c(),p("div",pl,[v("div",vl,[v("div",ml,[_(o,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=e=>u.value=e),onChange:R},{default:f((()=>[(c(!0),p(g,null,h(m(t),(e=>(c(),w(r,{key:e,value:e},{default:f((()=>[x(j(m(nl)[e].label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"]),v("div",_l,[_(B,{value:q.value,"onUpdate:value":s[1]||(s[1]=e=>q.value=e),placeholder:"请输入项目名称",style:{width:"200px"},onSearch:R},null,8,["value"])])]),v("div",null,[_(T,{type:"primary",onClick:U,size:"large",class:"custom-purple-button"},{default:f((()=>[x("新建项目")])),_:1}),_(T,{type:"primary",onClick:P,size:"large",class:"ml-[10px] custom-purple-button"},{default:f((()=>[x("删除项目")])),_:1})])]),_(S,{columns:i,"row-key":e=>e._id.$oid,"data-source":m(n).data,pagination:e.pagination,loading:m(d),"row-selection":{selectedRowKeys:k.value,onChange:I}},{bodyCell:f((({column:e,record:t})=>{return["display_id"===e.dataIndex?(c(),p(g,{key:0},[x(j(t.display_id),1)],64)):"name"===e.dataIndex?(c(),p(g,{key:1},[x(j(t.name),1)],64)):"period"===e.dataIndex?(c(),p(g,{key:2},[x(j(t.period_start)+" to "+j(t.period_end),1)],64)):"status"===e.dataIndex?(c(),w(D,{key:3,color:m(nl)[t.project_status??0].color},{default:f((()=>[v("div",fl,[(c(),w(L(m(nl)[t.project_status??0].icon))),v("span",gl,j(m(nl)[t.project_status??0].label),1)])])),_:2},1032,["color"])):"time_modified"===e.dataIndex?(c(),p(g,{key:4},[x(j((i=t.last_modified.$date,new Date(i).toLocaleString())),1)],64)):"actions"===e.dataIndex?(c(),p(g,{key:5},[_(T,{type:"link",onClick:e=>(e=>{l.replace(`/project/manageRequirement/${e._id.$oid}`),a.updateCurrentProjectById(e._id.$oid)})(t)},{default:f((()=>[x("需求管理")])),_:2},1032,["onClick"]),_(T,{type:"link",onClick:e=>(e=>{$.value=e,C.value=!0})(t)},{default:f((()=>[x("详情")])),_:2},1032,["onClick"])],64)):y("",!0)];var i})),_:1},8,["row-key","data-source","pagination","loading","row-selection"]),_(z,{title:"项目详情",placement:"right",visible:C.value,onClose:s[2]||(s[2]=e=>C.value=!1),width:"800"},{default:f((()=>[$.value?(c(),w(cl,{key:0,project:$.value},null,8,["project"])):y("",!0)])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-4ce04948"]]),yl={class:"m-2rem"},bl=be(a({__name:"AddProject",setup(e){const l=s(),t=r([]),a=r({name:"",kind:"",description:"",period:null,repository:[],dateFrom:null,dateTo:null}),i=r({name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],kind:[{required:!0,message:"请选择测试环境",trigger:"change"}],description:[{required:!1,message:"请输入项目描述",trigger:"blur"}],period:[{required:!0,message:"请选择计划周期",trigger:"change"}],repository:[{required:!0,message:"请上传项目知识库文件",trigger:"change"}]}),n=r(),o=async e=>{const l=new FormData;oe();const i=new Blob([JSON.stringify({db_id:"temp",category:"knowledges"})]);l.append("user_file",e.raw),l.append("info",i),a.value.repository=t,await de.post("/api/upload_project_file",l)},d=()=>{var e;(null==(e=t._value)?void 0:e.length)?n.value.validate().then((()=>{const e={name:a.value.name,notes:a.value.description,periodStart:a.value.dateFrom,periodEnd:a.value.dateTo,kind:a.value.kind,fileList:t._value.map((e=>e.name))};de.put("/api/create_new_project",e).then((e=>{O.success("创建项目成功"),l.replace("/project/projectManage")})).catch((e=>{O.error("创建项目失败")}))})).catch((()=>{O.error("表单校验失败")})):O.error("请上传项目知识库")},u=()=>{l.replace("/project/projectManage")},v=(e,l)=>{(null==l?void 0:l.length)&&(a.value.dateFrom=l[0],a.value.dateTo=l[1])};return(e,l)=>{const s=b("a-input"),r=b("a-form-item"),m=b("a-select-option"),g=b("a-select"),h=b("a-textarea"),y=b("a-range-picker"),w=b("el-button"),j=b("el-upload"),q=b("a-button"),k=b("a-form"),C=b("a-card");return c(),p("div",yl,[_(C,{title:"新建项目"},{default:f((()=>[_(k,{model:a.value,rules:i.value,ref_key:"formRef",ref:n,"label-col":{span:4},"wrapper-col":{span:14}},{default:f((()=>[_(r,{label:"项目名称",name:"name"},{default:f((()=>[_(s,{value:a.value.name,"onUpdate:value":l[0]||(l[0]=e=>a.value.name=e),placeholder:"请输入项目名称",style:{width:"16.5rem"}},null,8,["value"])])),_:1}),_(r,{label:"测试环境",name:"kind"},{default:f((()=>[_(g,{value:a.value.kind,"onUpdate:value":l[1]||(l[1]=e=>a.value.kind=e),placeholder:"请选择测试环境",style:{width:"16.5rem"}},{default:f((()=>[_(m,{value:"VT"},{default:f((()=>[x("VT")])),_:1}),_(m,{value:"NI"},{default:f((()=>[x("NI")])),_:1}),_(m,{value:"dSPACE"},{default:f((()=>[x("dSPACE")])),_:1})])),_:1},8,["value"])])),_:1}),_(r,{label:"项目描述",name:"description"},{default:f((()=>[_(h,{value:a.value.description,"onUpdate:value":l[2]||(l[2]=e=>a.value.description=e),placeholder:"请输入项目描述",style:{width:"16.5rem"}},null,8,["value"])])),_:1}),_(r,{label:"计划周期",name:"period"},{default:f((()=>[_(y,{onChange:v,value:a.value.period,"onUpdate:value":l[3]||(l[3]=e=>a.value.period=e)},null,8,["value"])])),_:1}),_(r,{label:"项目知识库",name:"repository"},{default:f((()=>[_(j,{ref:"uploadRef","auto-upload":!1,"on-change":o,accept:".doc,.docx,.pdf,.xlsx,.png","file-list":t.value,"onUpdate:fileList":l[4]||(l[4]=e=>t.value=e)},{trigger:f((()=>[_(w,null,{default:f((()=>[x(" 上传文件 ")])),_:1})])),_:1},8,["file-list"])])),_:1}),_(r,{"wrapper-col":{offset:4,span:14}},{default:f((()=>[_(q,{onClick:d,type:"primary",class:"custom-purple-button"},{default:f((()=>[x("创建")])),_:1}),_(q,{onClick:u,style:{"margin-left":"16px"}},{default:f((()=>[x("取消")])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1})])}}}),[["__scopeId","data-v-2654d7a1"]]),wl={uploaded:"待解析",parsed:"已解析"},xl=e=>(C("data-v-f8ab14e8"),e=e(),$(),e),jl={class:"m-[2rem]"},ql={style:{"border-left":"4px solid purple"}},kl={class:"ml-[1rem]"},Cl={class:"flex-container"},$l={class:"flex-item"},Rl=xl((()=>v("strong",null,"项目ID:",-1))),Ul={class:"flex-item"},Il=xl((()=>v("strong",null,"测试环境:",-1))),Pl={class:"flex-item"},Bl=xl((()=>v("strong",null,"计划周期:",-1))),Tl={class:"flex-item"},Dl=xl((()=>v("strong",null,"项目描述:",-1))),Sl={style:{"border-left":"4px solid purple",display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},zl={class:"ml-[1rem] flex align-center justify-center"},Fl={key:0},Ol={class:"flex requirement"},Vl={class:"flex-1 requirement-item"},Ll={class:"flex-1 requirement-item"},Ml={class:"flex-1 requirement-item"},El={class:"flex-1 requirement-item"},Al={class:"flex-1 requirement-item"},Nl={class:"flex-1 requirement-item"},Kl={class:"flex-1 flex",style:{gap:"1rem"}},Yl={key:1,class:"flex justify-center items-center w-full"},Hl=xl((()=>v("div",null,"暂无数据，请",-1))),Jl=xl((()=>v("span",{style:{color:"purple",cursor:"pointer"}},"上传需求",-1))),Wl=be(a({__name:"RequirementManage",setup(e){const l=ue(),{currentProject:a}=n(l);d(a,(e=>{}));const i=o((()=>{var e;return(null==(e=a.value)?void 0:e.requirement_files)||[]})),s=async e=>{if(i.value.length>=5)return void t.error("一个项目最多上传五个需求文档");const s=new FormData,r=new Blob([JSON.stringify({db_id:a.value._id.$oid,category:"requirments_docx"})]);s.append("user_file",e.raw),s.append("info",r),await de.post("/api/upload_project_file",s),await l.refreshProject(a.value._id.$oid)},r=async()=>{await l.refreshProject(a.value._id.$oid),t.success("需求文档已刷新")};return(e,n)=>{const o=b("a-card"),d=b("a-button"),u=b("el-upload"),y=b("el-button");return c(),p("div",jl,[_(o,null,{default:f((()=>[v("div",ql,[v("div",kl,j(m(a).name),1)]),v("div",Cl,[v("div",$l,[Rl,x(" "+j(m(a)._id.$oid),1)]),v("div",Ul,[Il,x(" "+j(m(a).kind),1)]),v("div",Pl,[Bl,x(" "+j(m(a).period_start)+" 至 "+j(m(a).period_end),1)]),v("div",Tl,[Dl,x(" "+j(m(a).notes||"无描述"),1)])])])),_:1}),_(o,{style:{"margin-top":"1rem"}},{default:f((()=>{var e;return[v("div",Sl,[v("div",zl,[x("需求文档 "),v("div",{class:"ml-[1rem] pb-[2px]",style:{cursor:"pointer",transform:"translateY(-3px)"},onClick:r},[_(m(M))])]),_(u,{ref:"uploadRef","auto-upload":!1,"on-change":s,"show-file-list":!1,accept:".doc,.docx,.pdf"},{trigger:f((()=>[_(d,{type:"primary",size:"large",class:"custom-purple-button"},{icon:f((()=>[_(m(E),{style:{transform:"translateY(-3px)"}})])),default:f((()=>[x(" 上传需求 ")])),_:1})])),_:1},512)]),(null==(e=i.value)?void 0:e.length)?(c(),p("div",Fl,[(c(!0),p(g,null,h(i.value,(e=>(c(),p("div",Ol,[v("div",Vl,j(e.req_id),1),v("div",Ll,j(e.name.split("/")[1]),1),v("div",Ml,j(e.creator),1),v("div",El,j(e.created_time),1),v("div",Al,j("V"+e.version),1),v("div",Nl,j(m(wl)[e.status]),1),v("div",Kl,[_(u,{ref_for:!0,ref:"uploadRef","auto-upload":!1,"on-change":i=>(async(e,i)=>{const s=new FormData,r=new Blob([JSON.stringify({db_id:a.value._id.$oid,category:"update_requirments_docx",req_id:i.req_id,req_name:i.name,req_creator:i.creator,new_file_name:e.name,version:i.version})]);s.append("user_file",e.raw),s.append("info",r),await de.post("/api/upload_project_file",s).then((e=>{"OK"===e.status?t.success("更新成功"):t.error("更新失败")})),await l.refreshProject(a.value._id.$oid)})(i,e),"show-file-list":!1,accept:".doc,.docx,.pdf"},{trigger:f((()=>[_(y,{type:"text"},{default:f((()=>[x("更新")])),_:1})])),_:2},1032,["on-change"]),_(y,{type:"text",onClick:l=>(async e=>{t.success("已下发解析请求, 请等待一段时间或刷新后查看"),await de.post("/api/do_split_requirement",e)})(e)},{default:f((()=>[x("解析")])),_:2},1032,["onClick"])])])))),256))])):(c(),p("div",Yl,[Hl,_(u,{ref:"uploadRef","auto-upload":!1,"on-change":s,"show-file-list":!1,accept:".doc,.docx,.pdf"},{trigger:f((()=>[Jl])),_:1},512)]))]})),_:1})])}}}),[["__scopeId","data-v-f8ab14e8"]]);function Gl(){return{handler:{Create:async e=>await de.put("/api/create_new_project",e),Detail:async e=>function(e){var l,t,a,i;const s=[],r=[],n=[];Object.keys(e.files||{}).forEach((l=>{const t=e.files[l];"main_docx"==l&&s.push({name:t.file_name,url:t.object_name,...t})})),e.files.dbc_data&&r.push(e.files.dbc_data);e.files.testcase&&r.push(e.files.testcase);e.files.mappings_1&&r.push(e.files.mappings_1);e.files.mappings_1&&r.push(e.files.mappings_2);e.files.mappings_1&&r.push(e.files.mappings_3);e.files.vtt_script&&n.push(e.files.vtt_script);const o=[...(null==(t=null==(l=e.files)?void 0:l.main_docx)?void 0:t.split_files)||[],...r,...n],{test_requirements:d,test_cases:u,test_scripts:c}=(null==e?void 0:e.status)||{};return{...e,_active:2==c?3:2==u?2:2==d?1:0,_savePath:e.storage_path,_downloadPath:e.download_path,_requirementFileList:s,_exampleFileList:r,_scriptFileList:n,_allFile:o,_create_at:D(null==(a=e.time_created)?void 0:a.$date).format("YYYY-MM-DD HH:mm:ss"),_update_at:D(null==(i=e.last_modified)?void 0:i.$date).format("YYYY-MM-DD HH:mm:ss")}}((await de.get(`/api/project_info/${e}`)).project_data),Delete:async e=>await de.delete(`/api/delete_project/${e}`),UploadFile:async e=>(await de.post("/api/upload_project_file",e)).status,ReplaceFile:async e=>(await de.post("/api/replace_document",e)).status,DownloadFile:async(e,l)=>await de.post("/api/get_document",{project_id:e,object_name:l},{responseType:"blob"}),DownloadTemplate:async(e,l="映射表模版文件.xlsx")=>de.get("/api/download_template",{responseType:"blob"}).then((t=>{var a;(a=t,new Promise(((e,l)=>{const t=new FileReader;t.onloadend=()=>{const l=t.result;e(l)},t.onerror=l,t.readAsDataURL(a)}))).then((t=>{window.electron.ipcRenderer.send("start-download",t,e,l)}))})),ParseDocument:async e=>await de.post("/api/do_split_workflow",{project_id:e,company:"dongfeng"}),GenerateTestcase:async(e,l)=>await de.post("/api/generate_testcase",{project_id:e,user_already_uploaded:l,company:"dongfeng"}),GenerateTestcaseNew:async e=>await de.post("/api/generate_testcase_new",{project_id:e}),GenerateScript:async e=>await de.post("/api/generate_scripts",{project_id:e}),getGenerationErrors:async e=>await de.post("/api/script_generation_errors",{project_id:e}),updateGenerationErrors:async(e,l)=>await de.post("/api/update_error_specifications",{project_id:e,error_feedback:l}),generateMappings:async e=>await de.post("/api/create_mappings",{project_id:e}),StopTask:async(e,l)=>de.delete("/api/cancel_job",{headers:{"Content-Type":"application/json"},data:{project_id:e,job_id:l,task_type:"generate_testcase"}}),DeleteFile:async(e,l,t)=>de.delete("/api/delete_project_file",{headers:{"Content-Type":"application/json"},data:{project_id:e,object_type:l,chunk_index:t}})}}}class Ql{constructor(e){A.register({"modules/better-table":N},!0),this.quill=new A(e,{theme:"snow",modules:{table:!1,"better-table":{operationMenu:{items:{unmergeCells:{text:""}}}},keyboard:{bindings:N.keyboardBindings}}})}docxToQuill(e){const l=new FileReader;l.onload=e=>{K.convertToHtml({arrayBuffer:e.target.result,includeDefaultStyleMap:!1,styleMap:{}}).then((e=>{this.html=e.value,this.quill.setContents([]),this.quill.clipboard.dangerouslyPasteHTML(this.html)})).catch((e=>{}))},l.readAsArrayBuffer(e)}}const Xl={class:"flex mt-[2rem] mb-[1rem]"},Zl=(e=>(C("data-v-54705c70"),e=e(),$(),e))((()=>v("div",{class:"w-[160px] ml-[1rem] flex items-center justify-center"}," 功能模块名称 ",-1))),et={class:"flex justify-center mt-[1rem]"},lt=be(a({__name:"RequirementDocx",props:{record:{type:Object,required:!0},currentRequirement:{type:Object}},setup(e){const{handler:l}=Gl(),a=e,i=r(a.record.file_name.replace(".docx","")),s=r();let n;u((async()=>{n=new Ql(s.value),l.DownloadFile(a.record.object_name.split("/")[0],a.record.object_name).then((e=>{const l=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),t=new File([l],a.record.object_name);n.docxToQuill(t)}))}));const{refreshAllProjects:o}=ue(),d=()=>{Y.confirm("保存后会覆盖文件，是否确定？","覆盖提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{H(n.quill.getSemanticHTML()).then((e=>{const s=new File([e],i.value,{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),r=new FormData,n=new Blob([JSON.stringify({db_id:a.currentRequirement.project._id.$oid,category:"save_requirement_docx",...a.record,newFileName:i.value,req_id:a.currentRequirement.req.req_id})]);r.append("user_file",s),r.append("info",n),l.UploadFile(r).then((e=>{e?(t.success("保存成功"),a.record.version=(Number(a.record.version)+.1).toFixed(1),o()):t.error("保存失败")}))}))}))};return(e,l)=>{const t=b("a-input"),a=b("a-button");return c(),p(g,null,[v("div",null,[v("div",Xl,[Zl,_(t,{value:i.value,"onUpdate:value":l[0]||(l[0]=e=>i.value=e),placeholder:"输入文件名",style:{width:"18.5rem"}},null,8,["value"])])]),v("div",{ref_key:"quillEditorRef",ref:s,class:"docx-editor"},null,512),v("div",et,[_(a,{type:"primary",size:"large",onClick:d,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])],64)}}}),[["__scopeId","data-v-54705c70"]]),tt=a({__name:"AddRequirementDocx",setup(e,{expose:l}){const t=r();let a=r();return u((()=>{a.value=new Ql(t.value);const e=new Blob([],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),l=new File([e],"empty.docx");a.value.docxToQuill(l)})),l({documentWordEdit:a}),(e,l)=>(c(),p("div",{ref_key:"quillEditorRef",ref:t,class:"docx-editor"},null,512))}}),at=e=>(C("data-v-c916717d"),e=e(),$(),e),it={class:"mb-4"},st=at((()=>v("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"moduleDescription"}," 功能模块名称 ",-1))),rt={class:"mb-4"},nt=at((()=>v("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"moduleDescription"}," 功能模块定义文档 ",-1))),ot={class:"mb-4"},dt=at((()=>v("label",{class:"block text-gray-700 text-sm font-bold mb-2",for:"moduleDescription"}," 功能模块描述 ",-1))),ut={class:"flex justify-end"},ct=be(a({__name:"AddModuleDrawer",props:{visible:Boolean,currentRequirement:Object},emits:["close"],setup(e,{emit:l}){const a=e,i=l,s=r(""),n=r(""),o=r(null),d=()=>{i("close")},u=()=>{const e=o.value;if(e&&e.documentWordEdit){const l=e.documentWordEdit;H(l.quill.getSemanticHTML()).then((e=>{const l=new File([e],s.value,{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),i=new FormData,r=new Blob([JSON.stringify({name:s.value,description:n.value,project_id:a.currentRequirement.project._id.$oid,req_id:a.currentRequirement.req.req_id,version:a.currentRequirement.req.version})]);i.append("user_file",l),i.append("info",r),de.post("/api/add_function_module",i).then((e=>{e.status?(t.success("保存成功"),d()):(t.error("保存失败"),d())}))}))}};return(l,t)=>{const a=b("a-input"),i=b("a-textarea"),r=b("a-button"),p=b("a-drawer");return c(),w(p,{title:"新建功能模块",visible:e.visible,onClose:d,placement:"right",width:500},{default:f((()=>[v("div",null,[v("div",it,[st,_(a,{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),placeholder:"请输入功能模块名称"},null,8,["value"])]),v("div",rt,[nt,_(tt,{ref_key:"requirementDocxRef",ref:o},null,512)]),v("div",ot,[dt,_(i,{value:n.value,"onUpdate:value":t[1]||(t[1]=e=>n.value=e),placeholder:"请输入功能模块描述"},null,8,["value"])]),v("div",ut,[_(r,{type:"primary",onClick:u,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])])])),_:1},8,["visible"])}}}),[["__scopeId","data-v-c916717d"]]),pt=e=>(C("data-v-4df01fe6"),e=e(),$(),e),vt={class:"flex"},mt={style:{height:"100%","border-right":"1px solid #ddd"},class:"m-[20px] mb-[0] w-[400px] flex flex-col"},_t={style:{"border-bottom":"1px solid #ddd","padding-bottom":"1rem"}},ft={style:{height:"2rem",margin:"1rem"}},gt={style:{height:"calc(100vh - 10.3rem)",overflow:"scroll","background-color":"rgba(248, 248, 254, 0.5)"}},ht={class:"w-full pt-[2rem] overflow-scroll"},yt={class:"editor-container"},bt=pt((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"功能模块",-1))),wt={class:"flex mt-[2rem] mb-[1rem]"},xt=pt((()=>v("div",{class:"w-[200px] ml-[1rem]"}," 功能模块名称 ",-1))),jt={class:"w-[200px] ml-[1rem]"},qt={class:"flex justify-center mt-[1rem]"},kt={style:{"text-align":"center",color:"red","font-size":"12px","margin-top":"1rem"}},Ct={class:"w-full pt-[2rem]",style:{height:"90vh"}},$t=pt((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"项目信息",-1))),Rt={class:"flex-container",style:{"margin-left":"1rem"}},Ut={class:"flex-item"},It=pt((()=>v("strong",null,"项目ID:",-1))),Pt={class:"flex-item"},Bt=pt((()=>v("strong",null,"测试环境:",-1))),Tt={class:"flex-item"},Dt=pt((()=>v("strong",null,"计划周期:",-1))),St={class:"flex-item"},zt=pt((()=>v("strong",null,"项目描述:",-1))),Ft=pt((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-top":"1rem","margin-bottom":"1rem"}}," 功能模块信息",-1))),Ot={class:"w-full flex justify-end mr-[2rem] mb-[1rem]"},Vt={style:{width:"100%"}},Lt={class:"flex justify-center"},Mt=be(a({__name:"FunctionModule",setup(e){const l=r(""),a=r();r();const i=ue(),{refreshAllProjects:s}=ue(),{projects:d}=n(i),h=r(!0),y=r(!1),{handler:w}=Gl(),q=r(),k=r(),C=r();let $;r(),u((async()=>{$=new Ql(C.value)}));const R=r(""),U=o((()=>{const e=(l,t)=>l.map((l=>{const a=l.children?e(l.children,t):[];return l.title.includes(t)||a.length>0?{...l,children:a}:null})).filter((e=>null!==e));return""===l.value.trim()?d.value.map(((e,l)=>({title:e.name,key:`0-${l}`,project:e,children:e.requirement_files&&e.requirement_files.length>0?e.requirement_files.map(((t,a)=>({title:t.name.split("/").pop(),key:`0-${l}-${a}`,fullPath:t.name,req:t,project:e,type:"requirement",children:t.split_files&&t.split_files.length>0?t.split_files.map(((i,s)=>({title:i.file_name.replace(".docx",""),key:`0-${l}-${a}-${s}`,fullPath:i.object_name,splitReq:i,req:t,project:e,type:"sub_requirement"}))):[]}))):[]}))):e(d.value.map(((e,l)=>({title:e.name,key:`0-${l}`,project:e,children:e.requirement_files&&e.requirement_files.length>0?e.requirement_files.map(((t,a)=>({title:t.name.split("/").pop(),key:`0-${l}-${a}`,fullPath:t.name,req:t,project:e,type:"requirement",children:t.split_files&&t.split_files.length>0?t.split_files.map(((i,s)=>({title:i.file_name.replace(".docx",""),key:`0-${l}-${a}-${s}`,fullPath:i.object_name,splitReq:i,req:t,project:e,type:"sub_requirement"}))):[]}))):[]}))),l.value)})),I=e=>{l.value=e},P=(e,l)=>{var i,s,r;"requirement"===(null==(i=null==l?void 0:l.node)?void 0:i.type)?(R.value="requirement",k.value=l.node):"sub_requirement"===(null==(s=null==l?void 0:l.node)?void 0:s.type)?(R.value="sub_requirement",k.value=l.node,(e=>{const{splitReq:l,project:i}=e;if(!0===l.is_table)return void t.error("该docx包含表格 暂时无法在 Word 编辑器中预览");const s=i._id.$oid;w.DownloadFile(s,l.object_name).then((t=>{const i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),s=new File([i],l.file_name);$.docxToQuill(s),a.value=e,q.value=l.file_name.replace(".docx","")}))})(null==l?void 0:l.node)):"split_case"===(null==(r=null==l?void 0:l.node)?void 0:r.type)&&(R.value="split_case",k.value=l.node)},B=()=>{Y.confirm("保存后会覆盖文件，是否确定？","覆盖提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{H($.quill.getSemanticHTML()).then((e=>{const l=new File([e],q.value,{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),i=new FormData,r=new Blob([JSON.stringify({db_id:a.value.project._id.$oid,category:"save_requirement_docx",...a.value.splitReq,newFileName:q.value,req_id:a.value.req.req_id})]);i.append("user_file",l),i.append("info",r),w.UploadFile(i).then((e=>{e?(t.success("保存成功"),a.value.splitReq.version=(Number(a.value.splitReq.version)+.1).toFixed(1),s()):t.error("保存失败")}))}))}))},T=r(1),D=r(10),F=r(1e3),O=o((()=>{var e,l;const t=(T.value-1)*D.value,a=t+D.value;return(null==(l=null==(e=k.value)?void 0:e.req)?void 0:l.split_files.slice(t,a))||[]})),V=o((()=>{var e,l;return(null==(l=null==(e=k.value)?void 0:e.req)?void 0:l.split_files.length)||0})),L=e=>{T.value=e},M=()=>{0!==W.value.length?Y.confirm("拆分会覆盖当前模块的已有功能点，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=W.value.map((e=>({project_id:k.value.project._id.$oid,object_name:e.object_name,split_file_id:e.split_file_id,version:e.version,req_id:k.value.req.req_id})));de.post("/api/subrequire_batch_generate_points",e).then((e=>{e?(t.success("已下发功能点拆解任务，请等待或刷新后去功能点页面查看结果"),s()):t.error("拆分失败")}))})).catch((()=>{t.info("已取消拆分操作")})):t.warning("请选择要拆分的功能模块")};J((()=>{const e=document.getElementById("function_module_table");if(e){const l=e.getBoundingClientRect().width;F.value=l}}));const E=r(!1);r(""),r("");const A=()=>{E.value=!0},N=async()=>{E.value=!1;const e=(await i.refreshAllProjects()).find((e=>e._id.$oid===k.value.project._id.$oid)).requirement_files.find((e=>e.req_id===k.value.req.req_id));k.value.req.split_files=e.split_files},K=e=>{N()},W=r([]),G=e=>{W.value=e},Q=()=>{0!==W.value.length?Y.confirm("确定要删除选中的功能模块吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=W.value.map((e=>e.split_file_id)),l={project_id:k.value.project._id.$oid,req_id:k.value.req.req_id,split_file_ids:e};de.post("/api/delete_function_module",l).then((l=>{var a,i;l?(t.success("删除成功"),s(),k.value.req.split_files=null==(i=null==(a=k.value)?void 0:a.req)?void 0:i.split_files.filter((l=>!e.includes(l.split_file_id)))):t.error("删除失败")}))})).catch((()=>{t.info("已取消删除操作")})):t.warning("请选择要删除的功能模块")};return(e,l)=>{var i,s,r,n,o,u,w,$,H,J,W,X,Z,ee,le,te,ae;const ie=b("a-input-search"),se=b("a-tree"),re=b("a-input"),ne=b("a-button"),oe=b("el-table-column"),ue=b("el-button"),ce=b("el-table"),pe=b("el-pagination");return c(),p(g,null,[v("div",vt,[v("div",mt,[v("div",_t,"全部项目 ("+j(m(d).length)+")",1),v("div",ft,[_(ie,{placeholder:"请输入要搜索的名称",style:{width:"100%"},onSearch:I})]),v("div",gt,[_(se,{"show-line":h.value,"show-icon":y.value,"default-expanded-keys":["0-0-0"],"tree-data":U.value,onSelect:P},{icon:f((()=>[])),_:1},8,["show-line","show-icon","tree-data"])])]),v("div",ht,[S(v("div",yt,[bt,v("div",wt,[xt,_(re,{value:q.value,"onUpdate:value":l[0]||(l[0]=e=>q.value=e),placeholder:"输入文件名",style:{width:"16.5rem"}},null,8,["value"]),v("div",jt,"V"+j(null==(s=null==(i=a.value)?void 0:i.splitReq)?void 0:s.version),1)]),v("div",{ref_key:"quillEditorRef",ref:C,class:"docx-editor"},null,512),v("div",qt,[_(ne,{type:"primary",size:"large",onClick:B,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})]),v("div",kt,"提示：当前为V"+j(null==(n=null==(r=a.value)?void 0:r.splitReq)?void 0:n.version)+"版本 由文档"+j(((null==(u=null==(o=a.value)?void 0:o.req)?void 0:u.name)||"").split("/")[1])+" v1版本生成 保存后版本新增",1)],512),[[z,a.value&&"sub_requirement"===R.value]]),S(v("div",Ct,[$t,v("div",Rt,[v("div",Ut,[It,x(" "+j(null==(H=null==($=null==(w=k.value)?void 0:w.project)?void 0:$._id)?void 0:H.$oid),1)]),v("div",Pt,[Bt,x(" "+j(null==(W=null==(J=k.value)?void 0:J.project)?void 0:W.kind),1)]),v("div",Tt,[Dt,x(" "+j(null==(Z=null==(X=k.value)?void 0:X.project)?void 0:Z.period_start)+" 至 "+j(null==(le=null==(ee=k.value)?void 0:ee.project)?void 0:le.period_end),1)]),v("div",St,[zt,x(" "+j((null==(ae=null==(te=k.value)?void 0:te.project)?void 0:ae.notes)||"无描述"),1)])]),Ft,v("div",Ot,[_(ne,{type:"primary",size:"large",onClick:A,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("新建功能模块")])),_:1}),_(ne,{type:"primary",size:"large",onClick:Q,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("删除")])),_:1}),_(ne,{type:"primary",size:"large",onClick:M,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("批量拆分")])),_:1})]),v("div",Vt,[_(ce,{data:O.value,style:{width:"100%"},id:"function_module_table",onSelectionChange:G},{default:f((()=>[_(oe,{type:"selection",width:"50"}),_(oe,{type:"expand",width:"70"},{default:f((e=>[_(lt,{record:e.row},null,8,["record"])])),_:1}),_(oe,{prop:"split_file_id",label:"功能模块ID",width:F.value/7||100},null,8,["width"]),_(oe,{prop:"file_name",label:"功能模块名称",width:F.value/7||100},{default:f((e=>{var l;return[x(j(null==(l=e.row.file_name)?void 0:l.replace(".docx","")),1)]})),_:1},8,["width"]),_(oe,{prop:"description",label:"功能模块描述",width:F.value/7||100},null,8,["width"]),_(oe,{prop:"version",label:"版本",width:F.value/7||100},null,8,["width"]),_(oe,{label:"操作",width:F.value/7||100},{default:f((e=>[_(ue,{type:"text",onClick:l=>{return a=e.row,void Y.confirm("拆分会覆盖当前模块的已有功能点，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={project_id:k.value.project._id.$oid,...a,req_id:k.value.req.req_id};t.success("已下发功能点拆解任务，请等待或刷新后去功能点页面查看结果"),de.post("/api/subrequire_generate_points",e).then((e=>{}))})).catch((()=>{t.info("已取消拆分操作")}));var a},disabled:!0===e.row.is_table},{default:f((()=>[x("拆分")])),_:2},1032,["onClick","disabled"])])),_:1},8,["width"])])),_:1},8,["data"]),v("div",Lt,[_(pe,{layout:"prev, pager, next",total:V.value,"page-size":D.value,"current-page":T.value,onCurrentChange:L},null,8,["total","page-size","current-page"])])])],512),[[z,"requirement"===R.value]])])]),_(ct,{visible:E.value,onClose:N,onSave:K,currentRequirement:k.value},null,8,["visible","currentRequirement"])],64)}}}),[["__scopeId","data-v-4df01fe6"]]),Et=e=>(C("data-v-3d37a942"),e=e(),$(),e),At={class:"flex"},Nt={style:{height:"100%","border-right":"1px solid #ddd"},class:"m-[20px] w-[400px]"},Kt={style:{"border-bottom":"1px solid #ddd","padding-bottom":"1rem"}},Yt={style:{height:"2rem",margin:"1rem"}},Ht={style:{height:"calc(100vh - 10.3rem)",overflow:"scroll","background-color":"rgba(248, 248, 254, 0.5)"}},Jt={class:"w-full h-[90%] pt-[2rem] overflow-scroll"},Wt={class:"w-full pt-[2rem]",style:{height:"90vh"}},Gt=Et((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"项目信息",-1))),Qt={class:"flex-container",style:{"margin-left":"1rem"}},Xt={class:"flex-item"},Zt=Et((()=>v("strong",null,"项目ID:",-1))),ea={class:"flex-item"},la=Et((()=>v("strong",null,"测试环境:",-1))),ta={class:"flex-item"},aa=Et((()=>v("strong",null,"计划周期:",-1))),ia={class:"flex-item"},sa=Et((()=>v("strong",null,"项目描述:",-1))),ra=Et((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-top":"1rem","margin-bottom":"1rem"}}," 功能模块信息",-1))),na={class:"w-full flex justify-end mr-[2rem] mb-[1rem]"},oa={style:{width:"100%"}},da={class:"flex justify-center"},ua={class:"w-full pt-[2rem]",style:{height:"calc(100vh - 5.3rem)"}},ca=Et((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"功能模块名称",-1))),pa={class:"flex-container",style:{"margin-left":"1rem"}},va={class:"flex-item"},ma=Et((()=>v("strong",null,"功能模块名称:",-1))),_a={class:"flex-item"},fa=Et((()=>v("strong",null,"功能模块ID:",-1))),ga={class:"flex-item"},ha=Et((()=>v("strong",null,"当前版本:",-1))),ya={class:"flex-item"},ba=Et((()=>v("strong",null,"项目描述:",-1))),wa=Et((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-top":"1rem","margin-bottom":"1rem"}}," 功能点信息 ",-1))),xa={style:{width:"100%"}},ja={class:"w-full flex justify-end mr-[2rem] mb-[1rem]"},qa={style:{padding:"10px"}},ka={class:"flex",style:{border:"1px solid #eee"}},Ca=Et((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件",-1))),$a={class:"flex",style:{border:"1px solid #eee"}},Ra=Et((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件",-1))),Ua={class:"flex",style:{border:"1px solid #eee"}},Ia=Et((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果",-1))),Pa={class:"w-full pt-[2rem]",style:{height:"calc(100vh - 5.3rem)"}},Ba=Et((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-bottom":"1rem"}}," 功能点 ",-1))),Ta={class:"flex justify-center items-center",style:{"flex-direction":"column"}},Da={style:{color:"red"}},Sa={class:"flex justify-center items-center",style:{"flex-direction":"column"}},za={class:"flex justify-center items-center",style:{"flex-direction":"column"}},Fa=be(a({__name:"FunctionPoint",setup(e){const l=r(),a=r(!1),i=r(!1),s=ue(),{refreshAllProjects:d}=ue(),{projects:u}=n(s);r(!0),r(!1);const h=r(),k=r([]),C=r([]),$=r({name:"",pre_condition:"",action:"",result:"",version:"",project_id:"",testcase_id:""}),R=r({name:"",pre_condition:"",action:"",result:"",project_id:"",req_id:"",split_file_id:"",split_req_version:""}),U=r(""),I=e=>{U.value=e},P=(e,l)=>e.map((e=>{const t=e.children?P(e.children,l):[];return e.title.includes(l)||t.length>0?{...e,children:t}:null})).filter((e=>null!==e)),B=o((()=>""===U.value.trim()?u.value.map(((e,l)=>({title:e.name,key:`0-${l}`,project:e,type:"project",children:e.requirement_files&&e.requirement_files.length>0?e.requirement_files.map(((t,a)=>({title:t.name.split("/").pop(),key:`0-${l}-${a}`,fullPath:t.name,req:t,project:e,type:"requirement",children:t.split_files&&t.split_files.length>0?t.split_files.map(((i,s)=>({title:i.file_name.replace(".docx",""),key:`0-${l}-${a}-${s}`,fullPath:i.object_name,splitReq:i,req:t,project:e,type:"sub_requirement",children:i.split_case&&i.split_case.length>0?i.split_case.map(((r,n)=>({title:r.testcase_name||"",fullPath:r.testcase_name,key:`0-${l}-${a}-${s}-${n}`,splitCase:r,splitReq:i,req:t,project:e,type:"split_case"}))):[]}))):[]}))):[]}))):P(u.value.map(((e,l)=>({title:e.name,key:`0-${l}`,project:e,children:e.requirement_files&&e.requirement_files.length>0?e.requirement_files.map(((t,a)=>({title:t.name.split("/").pop(),key:`0-${l}-${a}`,fullPath:t.name,req:t,project:e,type:"requirement",children:t.split_files&&t.split_files.length>0?t.split_files.map(((i,s)=>({title:i.file_name.replace(".docx",""),key:`0-${l}-${a}-${s}`,fullPath:i.object_name,splitReq:i,req:t,project:e,type:"sub_requirement",children:i.split_case&&i.split_case.length>0?i.split_case.map(((r,n)=>({title:r.testcase_name||"",fullPath:r.testcase_name,key:`0-${l}-${a}-${s}-${n}`,splitCase:r,splitReq:i,req:t,project:e,type:"split_case"}))):[]}))):[]}))):[]}))),U.value))),T=(e,t)=>{var a,i,s;"requirement"===(null==(a=null==t?void 0:t.node)?void 0:a.type)?(l.value="requirement",h.value=t.node):"sub_requirement"===(null==(i=null==t?void 0:t.node)?void 0:i.type)?(l.value="sub_requirement",h.value=t.node):"split_case"===(null==(s=null==t?void 0:t.node)?void 0:s.type)&&(l.value="split_case",h.value=t.node,$.value={name:t.node.splitCase.testcase_name,pre_condition:t.node.splitCase.pre_condition,action:t.node.splitCase.action,result:t.node.splitCase.result,version:t.node.splitCase.version,testcase_id:t.node.splitCase.testcase_id,project_id:t.node.project._id.$oid,req_id:t.node.req.req_id,split_file_id:t.node.splitReq.split_file_id})},D=r(1),F=r(10),O=r(1e3),V=r(500),L=r(1e3),M=r(500);o((()=>{const e=(D.value-1)*F.value,l=e+F.value;return C.value.slice(e,l)||[]}));const E=r(1),A=r(10),N=r(1e3),K=o((()=>{var e,l;const t=(E.value-1)*A.value,a=t+A.value;return(null==(l=null==(e=h.value)?void 0:e.req)?void 0:l.split_files.slice(t,a))||[]})),H=o((()=>{var e,l;return(null==(l=null==(e=h.value)?void 0:e.req)?void 0:l.split_files.length)||0})),le=e=>{E.value=e};J((()=>{const e=document.getElementById("function_point_table");if(e){const l=e.getBoundingClientRect().width;O.value=l;const t=.7*window.innerHeight;V.value=t}})),J((()=>{const e=document.getElementById("function_module_table");if(e){const l=e.getBoundingClientRect().width;L.value=l;const t=.7*window.innerHeight;M.value=t}}));const te=async()=>{const e={...$.value,testcase_name:$.value.name};return delete e.name,de.post("/api/modify_split_case",e).then((e=>{e&&(t.success("保存成功"),d(),$.value.version=e.version)}))},ae=async()=>{const e={...R.value,testcase_name:R.value.name};return delete e.name,de.post("/api/modify_split_case",e).then((e=>{e&&(t.success("保存成功"),d(),R.value.version=e.version)}))},ie=()=>{R.value.project_id=h.value.project._id.$oid,R.value.split_file_id=h.value.splitReq.split_file_id,R.value.req_id=h.value.req.req_id,a.value=!0},se=()=>{a.value=!1},re=()=>{i.value=!1},ne=async()=>{if(!R.value.name)return void t.error("名称不能为空");if(!R.value.pre_condition)return void t.error("初始条件不能为空");if(!R.value.action)return void t.error("操作步骤不能为空");if(!R.value.result)return void t.error("预期结果不能为空");const e={...R.value,split_req_version:h.value.splitReq.version,testcase_name:R.value.name};return delete e.name,de.post("/api/create_split_case",e).then((async e=>{if(e){t.success("保存成功");const e=(await d()).find((e=>e._id.$oid===R.value.project_id)).requirement_files.find((e=>e.req_id===R.value.req_id)).split_files.find((e=>e.split_file_id===R.value.split_file_id));h.value.splitReq.split_case=e.split_case,se()}else t.error("保存失败")})).catch((()=>{t.error("保存失败")}))},oe=()=>{if(0===ge.value.length)return void t.warning("请选择要生成用例的功能模块");const e=h.value.project._id.$oid,l=h.value.splitReq.split_file_id,a=h.value.req.req_id;Y.confirm("生成用例会覆盖当前模块的已有用例，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const i=ge.value.map((t=>({...t,project_id:e,split_file_id:l,req_id:a,split_case_id:t.testcase_id})));de.post("/api/generate_testcases_by_points",{points:i}).then((async e=>{"OK"===(null==e?void 0:e.status)?(t.success("已下发生成用例任务"),await d()):t.error("下发生成用例任务失败")}))})).catch((()=>{t.info("已取消生成用例操作")}))},ce=r(!1);r(""),r("");const pe=()=>{ce.value=!0},ve=async()=>{ce.value=!1;const e=(await s.refreshAllProjects()).find((e=>e._id.$oid===h.value.project._id.$oid)).requirement_files.find((e=>e.req_id===h.value.req.req_id));h.value.req.split_files=e.split_files},me=()=>{0!==selectedRows.value.length?Y.confirm("拆分会覆盖当前模块的已有功能点，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=selectedRows.value.map((e=>({project_id:h.value.project._id.$oid,object_name:e.object_name,split_file_id:e.split_file_id,version:e.version,req_id:h.value.req.req_id})));de.post("/api/subrequire_batch_generate_points",e).then((e=>{e?(t.success("已下发功能点拆解任务，请等待或刷新后去功能点页面查看结果"),d()):t.error("拆分失败")}))})).catch((()=>{t.info("已取消拆分操作")})):t.warning("请选择要拆分的功能模块")},_e=r([]),fe=e=>{_e.value=e},ge=r([]),he=e=>{ge.value=e},ye=()=>{0!==_e.value.length?Y.confirm("确定要删除选中的功能模块吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=_e.value.map((e=>e.split_file_id)),l={project_id:h.value.project._id.$oid,req_id:h.value.req.req_id,split_file_ids:e};de.post("/api/delete_function_module",l).then((l=>{var a,i;l?(t.success("删除成功"),d(),h.value.req.split_files=null==(i=null==(a=h.value)?void 0:a.req)?void 0:i.split_files.filter((l=>!e.includes(l.split_file_id)))):t.error("删除失败")}))})).catch((()=>{t.info("已取消删除操作")})):t.warning("请选择要删除的功能模块")};return(e,s)=>{var r,n,o,d,C,U,P,D,F,V,L,M,J,ue,_e,ge,be,we,xe,je,qe,ke;const Ce=b("a-input-search"),$e=b("a-tree"),Re=b("a-button"),Ue=b("el-table-column"),Ie=b("el-button"),Pe=b("el-table"),Be=b("el-pagination"),Te=b("a-input"),De=b("a-form-item"),Se=b("a-textarea"),ze=b("a-form"),Fe=b("a-drawer");return c(),p(g,null,[v("div",At,[v("div",Nt,[v("div",Kt,"全部项目 ("+j(m(u).length)+")",1),v("div",Yt,[_(Ce,{placeholder:"请输入要搜索的名称",style:{width:"100%"},onSearch:I})]),v("div",Ht,[_($e,{"show-line":!1,"show-icon":!0,"default-expanded-keys":["0-0-0"],"tree-data":B.value,onSelect:T,selectedKeys:k.value,"onUpdate:selectedKeys":s[0]||(s[0]=e=>k.value=e)},{switcherIcon:f((({switcherCls:e})=>[_(m(W),{class:q(e)},null,8,["class"])])),icon:f((e=>["project"===e.type?(c(),w(m(G),{key:0})):y("",!0),"requirement"===e.type?(c(),w(m(Q),{key:1})):"sub_requirement"===e.type?(c(),w(m(X),{key:2})):"split_case"===e.type?(c(),w(m(Z),{key:3})):"testcase"===e.type?(c(),w(m(ee),{key:4})):y("",!0)])),_:1},8,["tree-data","selectedKeys"])])]),v("div",Jt,[S(v("div",Wt,[Gt,v("div",Qt,[v("div",Xt,[Zt,x(" "+j(null==(o=null==(n=null==(r=h.value)?void 0:r.project)?void 0:n._id)?void 0:o.$oid),1)]),v("div",ea,[la,x(" "+j(null==(C=null==(d=h.value)?void 0:d.project)?void 0:C.kind),1)]),v("div",ta,[aa,x(" "+j(null==(P=null==(U=h.value)?void 0:U.project)?void 0:P.period_start)+" 至 "+j(null==(F=null==(D=h.value)?void 0:D.project)?void 0:F.period_end),1)]),v("div",ia,[sa,x(" "+j((null==(L=null==(V=h.value)?void 0:V.project)?void 0:L.notes)||"无描述"),1)])]),ra,v("div",na,[_(Re,{type:"primary",size:"large",onClick:pe,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("新建功能模块")])),_:1}),_(Re,{type:"primary",size:"large",onClick:ye,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("删除")])),_:1}),_(Re,{type:"primary",size:"large",onClick:me,class:"custom-purple-button mr-[2rem]"},{default:f((()=>[x("批量拆分")])),_:1})]),v("div",oa,[_(Pe,{data:K.value,style:{width:"100%"},id:"function_module_table",onSelectionChange:fe},{default:f((()=>[_(Ue,{type:"selection",width:"50"}),_(Ue,{type:"expand",width:"70"},{default:f((e=>[_(lt,{record:e.row,currentRequirement:h.value},null,8,["record","currentRequirement"])])),_:1}),_(Ue,{prop:"split_file_id",label:"功能模块ID",width:N.value/7||100},null,8,["width"]),_(Ue,{prop:"file_name",label:"功能模块名称",width:N.value/7||100},{default:f((e=>{var l;return[x(j(null==(l=e.row.file_name)?void 0:l.replace(".docx","")),1)]})),_:1},8,["width"]),_(Ue,{prop:"version",label:"版本",width:N.value/7||100},null,8,["width"]),_(Ue,{prop:"status",label:"状态",width:O.value/10||100},{default:f((e=>[x(j(e.row.status?e.row.status:"待操作"),1)])),_:1},8,["width"]),_(Ue,{label:"操作",width:N.value/7||100},{default:f((e=>[_(Ie,{type:"text",onClick:l=>{return a=e.row,void Y.confirm("拆分会覆盖当前模块的已有功能点，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e={project_id:h.value.project._id.$oid,...a,req_id:h.value.req.req_id};t.success("已下发功能点拆解任务，请等待或刷新后去功能点页面查看结果"),de.post("/api/subrequire_generate_points",e).then((e=>{}))})).catch((()=>{t.info("已取消拆分操作")}));var a},disabled:!0===e.row.is_table},{default:f((()=>[x("拆分")])),_:2},1032,["onClick","disabled"])])),_:1},8,["width"])])),_:1},8,["data"]),v("div",da,[_(Be,{layout:"prev, pager, next",total:H.value,"page-size":A.value,"current-page":E.value,onCurrentChange:le},null,8,["total","page-size","current-page"])])])],512),[[z,"requirement"===l.value]]),S(v("div",ua,[ca,v("div",pa,[v("div",va,[ma,x(" "+j(null==(ue=null==(J=null==(M=h.value)?void 0:M.splitReq)?void 0:J.file_name)?void 0:ue.replace(".docx","")),1)]),v("div",_a,[fa,x(" "+j(null==(ge=null==(_e=h.value)?void 0:_e.splitReq)?void 0:ge.split_file_id),1)]),v("div",ga,[ha,x(" "+j(null==(we=null==(be=h.value)?void 0:be.splitReq)?void 0:we.version),1)]),v("div",ya,[ba,x(" "+j((null==(je=null==(xe=h.value)?void 0:xe.splitReq)?void 0:je.description)||"无描述"),1)])]),wa,v("div",xa,[v("div",ja,[_(Re,{type:"primary",size:"large",onClick:oe,class:"custom-purple-button mr-[2rem] mb-[1rem]"},{default:f((()=>[x("批量生成用例")])),_:1}),_(Re,{type:"primary",size:"large",onClick:ie,class:"custom-purple-button mr-[2rem] mb-[1rem]"},{default:f((()=>[x("新建功能点")])),_:1})]),_(Pe,{data:null==(ke=null==(qe=h.value)?void 0:qe.splitReq)?void 0:ke.split_case,style:{width:"100%"},id:"function_point_table",height:e.table_height,onSelectionChange:he},{default:f((()=>[_(Ue,{type:"selection",width:"50"}),_(Ue,{type:"expand"},{default:f((e=>[v("div",qa,[v("div",ka,[Ca,v("div",null,j(e.row.pre_condition),1)]),v("div",$a,[Ra,v("div",null,j(e.row.action),1)]),v("div",Ua,[Ia,v("div",null,j(e.row.result),1)])])])),_:1}),_(Ue,{prop:"testcase_id",label:"功能点ID",width:O.value/6||100},null,8,["width"]),_(Ue,{prop:"testcase_name",label:"功能点名称",width:O.value/7||100},null,8,["width"]),_(Ue,{prop:"last_modified.$date",label:"更新时间",width:O.value/7||100},null,8,["width"]),_(Ue,{prop:"version",label:"版本",width:O.value/7||100},null,8,["width"]),_(Ue,{prop:"status",label:"状态",width:O.value/10||100},{default:f((e=>[x(j(e.row.status?e.row.status:"待操作"),1)])),_:1},8,["width"]),_(Ue,{label:"操作",width:150},{default:f((e=>[_(Ie,{type:"text",style:{color:"blue"},onClick:l=>{return t=e.row,R.value.name=t.testcase_name,R.value.pre_condition=t.pre_condition,R.value.action=t.action,R.value.result=t.result,R.value.project_id=h.value.project._id.$oid,R.value.split_file_id=h.value.splitReq.split_file_id,R.value.req_id=h.value.req.req_id,R.value.testcase_id=t.testcase_id,R.value.version=t.version,void(i.value=!0);var t}},{default:f((()=>[x("修改")])),_:2},1032,["onClick"]),_(Ie,{type:"text",style:{color:"blue"},onClick:l=>(e=>{const l=h.value.project._id.$oid,a=h.value.splitReq.split_file_id,i=h.value.req.req_id,s=e.testcase_id,r={...e,project_id:l,split_file_id:a,req_id:i,split_case_id:s};delete r.testcases,de.post("/api/generate_testcases_by_points",{points:[r]}).then((async e=>{"OK"===(null==e?void 0:e.status)?t.success("已下发生成用例任务"):t.error("下发生成用例任务失败")}))})(e.row)},{default:f((()=>[x("生成用例")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","height"])])],512),[[z,"sub_requirement"===l.value]]),S(v("div",Pa,[Ba,_(ze,{model:$.value,layout:"vertical"},{default:f((()=>[_(De,{label:"功能点名称"},{default:f((()=>[_(Te,{value:$.value.name,"onUpdate:value":s[1]||(s[1]=e=>$.value.name=e),placeholder:"请输入功能点名称",rows:4},null,8,["value"])])),_:1}),_(De,{label:"初始条件"},{default:f((()=>[_(Se,{value:$.value.pre_condition,"onUpdate:value":s[2]||(s[2]=e=>$.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"触发条件"},{default:f((()=>[_(Se,{value:$.value.action,"onUpdate:value":s[3]||(s[3]=e=>$.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"预期结果"},{default:f((()=>[_(Se,{value:$.value.result,"onUpdate:value":s[4]||(s[4]=e=>$.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(De,null,{default:f((()=>[v("div",Ta,[_(Re,{type:"primary",onClick:te,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1}),v("div",Da,"提示：当前为V"+j($.value.version)+"版本 保存后版本新增",1)])])),_:1})])),_:1},8,["model"])],512),[[z,"split_case"===l.value]]),_(Fe,{title:"修改功能点",visible:i.value,width:720,onClose:re},{default:f((()=>[_(ze,{model:R.value,layout:"vertical"},{default:f((()=>[_(De,{label:"功能点名称"},{default:f((()=>[_(Te,{value:R.value.name,"onUpdate:value":s[5]||(s[5]=e=>R.value.name=e),placeholder:"请输入功能点名称",rows:4},null,8,["value"])])),_:1}),_(De,{label:"初始条件"},{default:f((()=>[_(Se,{value:R.value.pre_condition,"onUpdate:value":s[6]||(s[6]=e=>R.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"触发条件"},{default:f((()=>[_(Se,{value:R.value.action,"onUpdate:value":s[7]||(s[7]=e=>R.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"预期结果"},{default:f((()=>[_(Se,{value:R.value.result,"onUpdate:value":s[8]||(s[8]=e=>R.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(De,null,{default:f((()=>[v("div",Sa,[_(Re,{type:"primary",onClick:ae,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),_(Fe,{title:"新建功能点",visible:a.value,width:720,onClose:se},{default:f((()=>[_(ze,{model:R.value,layout:"vertical"},{default:f((()=>[_(De,{label:"功能点名称"},{default:f((()=>[_(Te,{value:R.value.name,"onUpdate:value":s[9]||(s[9]=e=>R.value.name=e),placeholder:"请输入功能点名称",rows:4},null,8,["value"])])),_:1}),_(De,{label:"初始条件"},{default:f((()=>[_(Se,{value:R.value.pre_condition,"onUpdate:value":s[10]||(s[10]=e=>R.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"触发条件"},{default:f((()=>[_(Se,{value:R.value.action,"onUpdate:value":s[11]||(s[11]=e=>R.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(De,{label:"预期结果"},{default:f((()=>[_(Se,{value:R.value.result,"onUpdate:value":s[12]||(s[12]=e=>R.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(De,null,{default:f((()=>[v("div",za,[_(Re,{type:"primary",onClick:ne,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])]),_(ct,{visible:ce.value,onClose:ve,onSave:e.saveNewModule,currentRequirement:h.value},null,8,["visible","onSave","currentRequirement"])],64)}}}),[["__scopeId","data-v-3d37a942"]]),Oa=e=>(C("data-v-705588ce"),e=e(),$(),e),Va={class:"flex"},La={style:{height:"100%","border-right":"1px solid #ddd"},class:"m-[20px] w-[600px]"},Ma={style:{"border-bottom":"1px solid #ddd","padding-bottom":"1rem"}},Ea={style:{height:"2rem",margin:"1rem"}},Aa={style:{height:"calc(100vh - 10.3rem)",overflow:"scroll","background-color":"rgba(248, 248, 254, 0.5)"}},Na={class:"w-full h-[90%] pt-[2rem] overflow-scroll"},Ka={class:"w-full pt-[2rem]",style:{height:"90vh"}},Ya=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"项目信息",-1))),Ha={class:"flex-container",style:{"margin-left":"1rem"}},Ja={class:"flex-item"},Wa=Oa((()=>v("strong",null,"项目ID:",-1))),Ga={class:"flex-item"},Qa=Oa((()=>v("strong",null,"测试环境:",-1))),Xa={class:"flex-item"},Za=Oa((()=>v("strong",null,"计划周期:",-1))),ei={class:"flex-item"},li=Oa((()=>v("strong",null,"项目描述:",-1))),ti=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-top":"1rem","margin-bottom":"1rem"}}," 测试用例信息",-1))),ai={class:"flex",style:{"justify-content":"flex-end","margin-right":"1rem","margin-bottom":"1rem"}},ii={style:{padding:"10px"}},si={class:"flex",style:{border:"1px solid #eee"}},ri=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件",-1))),ni={class:"flex",style:{border:"1px solid #eee"}},oi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件信号",-1))),di={class:"flex",style:{border:"1px solid #eee"}},ui=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件",-1))),ci={class:"flex",style:{border:"1px solid #eee"}},pi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件信号",-1))),vi={class:"flex",style:{border:"1px solid #eee"}},mi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果",-1))),_i={class:"flex",style:{border:"1px solid #eee"}},fi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果信号",-1))),gi={class:"flex justify-center mt-4"},hi={class:"w-full pt-[2rem]",style:{height:"90vh"}},yi=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem"}},"功能模块名称",-1))),bi={class:"flex-container",style:{"margin-left":"1rem"}},wi={class:"flex-item"},xi=Oa((()=>v("strong",null,"功能模块名称:",-1))),ji={class:"flex-item"},qi=Oa((()=>v("strong",null,"功能模块ID:",-1))),ki={class:"flex-item"},Ci=Oa((()=>v("strong",null,"当前版本:",-1))),$i={class:"flex-item"},Ri=Oa((()=>v("strong",null,"项目描述:",-1))),Ui=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-top":"1rem","margin-bottom":"1rem"}}," 测试用例信息 ",-1))),Ii={style:{width:"100%"}},Pi={class:"flex",style:{"justify-content":"flex-end","margin-right":"1rem","margin-bottom":"1rem"}},Bi={style:{padding:"10px"}},Ti={class:"flex",style:{border:"1px solid #eee"}},Di=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件",-1))),Si={class:"flex",style:{border:"1px solid #eee"}},zi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件信号",-1))),Fi={class:"flex",style:{border:"1px solid #eee"}},Oi=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件",-1))),Vi={class:"flex",style:{border:"1px solid #eee"}},Li=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件信号",-1))),Mi={class:"flex",style:{border:"1px solid #eee"}},Ei=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果",-1))),Ai={class:"flex",style:{border:"1px solid #eee"}},Ni=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果信号",-1))),Ki={class:"flex justify-center mt-4"},Yi={class:"w-full pt-[2rem]",style:{height:"90vh"}},Hi=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-bottom":"1rem"}}," 功能点信息 ",-1))),Ji={class:"flex-container",style:{"margin-left":"1rem"}},Wi={class:"flex-item"},Gi=Oa((()=>v("strong",null,"功能点名称:",-1))),Qi={class:"flex-item"},Xi=Oa((()=>v("strong",null,"功能点ID:",-1))),Zi={class:"flex-item"},es=Oa((()=>v("strong",null,"当前版本:",-1))),ls={class:"flex-item"},ts=Oa((()=>v("strong",null,"功能点描述:",-1))),as=Oa((()=>v("div",{style:{"border-left":"2px solid purple","margin-left":"1rem","padding-left":"1rem","margin-bottom":"1rem"}}," 测试用例 ",-1))),is={class:"flex",style:{"justify-content":"space-between","margin-right":"1rem","margin-bottom":"1rem"}},ss={class:"flex"},rs={style:{padding:"10px"}},ns={class:"flex",style:{border:"1px solid #eee"}},os=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件",-1))),ds={class:"flex",style:{border:"1px solid #eee"}},us=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 初始条件信号",-1))),cs={class:"flex",style:{border:"1px solid #eee"}},ps=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件",-1))),vs={class:"flex",style:{border:"1px solid #eee"}},ms=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 触发条件信号",-1))),_s={class:"flex",style:{border:"1px solid #eee"}},fs=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果",-1))),gs={class:"flex",style:{border:"1px solid #eee"}},hs=Oa((()=>v("div",{style:{"min-width":"100px","background-color":"#f2f2f2",padding:"10px","text-align":"center"}}," 预期结果信号",-1))),ys={style:{height:"90vh"}},bs={class:"flex justify-center items-center",style:{"flex-direction":"column"}},ws={style:{color:"red"}},xs={class:"flex justify-center items-center",style:{"flex-direction":"column"}},js={class:"flex justify-center items-center",style:{"flex-direction":"column"}},qs=[{path:"/login",name:"Login",component:Ee},{path:"/registry",name:"Registry",component:rl},{path:"/",redirect:"/login"},{path:"/project/projectManage",component:hl},{path:"/project/addProject",component:bl},{path:"/project/manageRequirement/:id",component:Wl},{path:"/requirement/functionModules",component:Mt},{path:"/requirement/functionPoints",component:Fa},{path:"/usecase/usecaseManage",component:be(a({__name:"UseCase",setup(e){const l=r(),a=r(!1),i=r(!1),s=ue(),{refreshAllProjects:d}=ue(),{projects:u}=n(s);r(!0),r(!1);const g=r(),h=r([]),k=r([]),C=r([]),$=r(10),R=r(1),U=o((()=>{const e=(R.value-1)*$.value,l=e+$.value;return C.value.slice(e,l)})),I=o((()=>C.value.length)),P=e=>{R.value=e},B=r([]),T=e=>{B.value=e},D=r({name:"",pre_condition:"",pre_condition_signal:"",action:"",action_signal:"",result:"",result_signal:"",version:"",project_id:"",testcase_id:""}),F=r({type:"",name:"",pre_condition:"",pre_condition_signal:"",action:"",action_signal:"",result:"",result_signal:"",project_id:"",req_id:"",split_file_id:"",split_req_version:"",split_case_id:"",split_case_version:""}),O=e=>{var l,t;if(!e.split_files)return[];const a=[];for(const i of e.split_files)if(null==(l=i.split_case)?void 0:l.length)for(const e of i.split_case)if(null==(t=e.testcases)?void 0:t.length)for(const l of e.testcases)l.split_case_name=e.testcase_name,l.split_file_name=i.file_name,a.push(l);return a},V=()=>{if(0===B.length)return void t.warning("请选择要泛化的测试用例");const e=B.value.map((e=>({...e,project_id:g.value.project._id.$oid,split_file_id:g.value.splitReq.split_file_id,req_id:g.value.req.req_id,split_case_id:g.value.splitCase.testcase_id})));for(const l of e)if(l.is_generalized)return void t.warning("请不要对已泛化的测试用例进行泛化操作");de.post("/api/split_gen_testcase",e).then((e=>{"ok"===e.status?(t.success("批量泛化下发成功"),d()):t.error("批量泛化下发失败")}))},L=()=>{if(0===B.value.length)return void t.warning("请选择要删除的测试用例");const e=B.value.map((e=>({project_id:g.value.project._id.$oid,req_id:g.value.req.req_id,split_file_id:g.value.splitReq.split_file_id,split_case_id:g.value.splitCase.testcase_id,testcase_id:e.testcase_id})));de.post("/api/delete_testcases",e).then((e=>{"OK"===e.status?(t.success("批量删除成功"),d(),g.value.splitCase.testcases=e.testcases):t.error("批量删除失败")}))},M=r(""),E=e=>{M.value=e},A=r(""),N=e=>{A.value=e},K=r(""),Y=o((()=>{var e,l;return((null==(l=null==(e=g.value)?void 0:e.splitCase)?void 0:l.testcases)||[]).filter((e=>e.testcase_name.includes(A.value))).filter((e=>e.type.includes(K.value)))})),H=(e,l)=>e.map((e=>{const t=e.children?H(e.children,l):[];return e.title.includes(l)||t.length>0?{...e,children:t}:null})).filter((e=>null!==e)),J=o((()=>{const e=M.value.trim(),l=e=>e.map(((e,l)=>({title:e.name,key:`0-${l}`,project:e,type:"project",children:e.requirement_files&&e.requirement_files.length>0?e.requirement_files.map(((t,a)=>({title:t.name.split("/").pop(),key:`0-${l}-${a}`,fullPath:t.name,req:t,project:e,type:"requirement",split_cases:O(t),children:t.split_files&&t.split_files.length>0?t.split_files.map(((i,s)=>({title:i.file_name.replace(".docx",""),key:`0-${l}-${a}-${s}`,fullPath:i.object_name,splitReq:i,req:t,project:e,type:"sub_requirement",split_cases:(i.split_case||[]).map(((e,l)=>{for(const[t,i]of(e.testcases||[]).entries())i.split_case_name=e.testcase_name,i.testcaseIndex=t,i.reqIndex=a,i.splitReqIndex=s,i.splitCaseIndex=l;return e.testcases||[]})),children:i.split_case&&i.split_case.length>0?i.split_case.map(((r,n)=>({title:r.testcase_name||"",fullPath:r.testcase_name,key:`0-${l}-${a}-${s}-${n}`,splitCase:r,splitReq:i,req:t,project:e,type:"split_case",children:r.testcases&&r.testcases.length>0?r.testcases.map(((o,d)=>({title:o.testcase_name||"",type:"testcase",key:`0-${l}-${a}-${s}-${n}-${d}`,splitCase:r,splitReq:i,req:t,project:e,testcase:o||[]}))):[]}))):[]}))):[]}))):[]})));return""===e?l(u.value):H(l(u.value),e)})),le=(e,t)=>{var a,i,s,r;if("requirement"===(null==(a=null==t?void 0:t.node)?void 0:a.type)){l.value="requirement",g.value=t.node;const e=t.node.split_cases||[];C.value=e}else if("sub_requirement"===(null==(i=null==t?void 0:t.node)?void 0:i.type)){l.value="sub_requirement",g.value=t.node;const e=t.node.split_cases.reduce(((e,l)=>e.concat(l??[])),[]);k.value=e}else"split_case"===(null==(s=null==t?void 0:t.node)?void 0:s.type)?(l.value="split_case",g.value=t.node,D.value={name:t.node.splitCase.testcase_name,pre_condition:t.node.splitCase.pre_condition,action:t.node.splitCase.action,action_signal:t.node.splitCase.action_signal,result_signal:t.node.splitCase.result_signal,pre_condition_signal:t.node.splitCase.pre_condition_signal,result:t.node.splitCase.result,version:t.node.splitCase.version,testcase_id:t.node.splitCase.testcase_id,project_id:t.node.project._id.$oid,req_id:t.node.req.req_id,split_file_id:t.node.splitReq.split_file_id}):"testcase"===(null==(r=null==t?void 0:t.node)?void 0:r.type)&&(l.value="testcase",g.value=t.node,D.value={name:t.node.testcase.testcase_name,pre_condition:t.node.testcase.pre_condition,action:t.node.testcase.action,result:t.node.testcase.result,version:t.node.testcase.version,type:t.node.testcase.type,testcase_id:t.node.testcase.testcase_id,project_id:t.node.project._id.$oid,req_id:t.node.req.req_id,split_file_id:t.node.splitReq.split_file_id,split_case_id:t.node.splitCase.testcase_id,action_signal:t.node.testcase.action_signal,result_signal:t.node.testcase.result_signal,pre_condition_signal:t.node.testcase.pre_condition_signal})},te=r(.6*window.innerWidth),ae=r(.5*window.innerHeight),ie=r(1),se=r(10),re=o((()=>{const e=(ie.value-1)*se.value,l=e+se.value;return k.value.slice(e,l)})),ne=o((()=>k.value.length)),oe=e=>{ie.value=e},ce=async()=>{const e={...D.value,split_req_version:g.value.splitReq.version,testcase_name:D.value.name,split_case_id:g.value.splitCase.testcase_id,split_case_version:g.value.splitCase.version,testcase_id:D.value.testcase_id};return de.post("/api/modify_testcase",e).then((async l=>{if("OK"===l.status){t.success("保存成功"),await d();const a=l.testcases.find((l=>l.testcase_id===e.testcase_id));D.value.version=a.version}}))},pe=async()=>{const e={...F.value,split_req_version:g.value.splitReq.version,testcase_name:F.value.name,split_case_id:g.value.splitCase.testcase_id,split_case_version:g.value.splitCase.version,testcase_id:F.value.testcase_id};return delete e.name,de.post("/api/modify_testcase",e).then((e=>{e&&(t.success("保存成功"),d())}))},ve=()=>{F.value.project_id=g.value.project._id.$oid,F.value.split_file_id=g.value.splitReq.split_file_id,F.value.req_id=g.value.req.req_id,a.value=!0},me=()=>{a.value=!1},_e=()=>{i.value=!1},fe=async()=>{if(!F.value.name)return void t.error("名称不能为空");if(!F.value.pre_condition)return void t.error("初始条件不能为空");if(!F.value.action)return void t.error("操作步骤不能为空");if(!F.value.result)return void t.error("预期结果不能为空");const e={...F.value,split_req_version:g.value.splitReq.version,testcase_name:F.value.name,split_case_id:g.value.splitCase.testcase_id,split_case_version:g.value.splitCase.version};return delete e.name,de.post("/api/create_testcase",e).then((async e=>{e?(t.success("保存成功"),g.value.splitCase.testcases=e.testcases,me()):t.error("保存失败")})).catch((()=>{t.error("保存失败")}))},ge=()=>{var e,l;if(!(null==(l=null==(e=g.value.splitCase)?void 0:e.testcases)?void 0:l.length))return void t.error("请先生成或添加用例");const a={project_id:g.value.project._id.$oid,split_file_id:g.value.splitReq.split_file_id,req_id:g.value.req.req_id,split_case_id:g.value.splitCase.testcase_id};de.post("/api/export_by_splitcase",a,{responseType:"blob"}).then((e=>{const l=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(l),a=document.createElement("a");a.href=t,a.setAttribute("download",g.value.splitCase.testcase_id+".xlsx"),document.body.appendChild(a),a.click()})).catch((()=>{t.error("导出失败")}))},he=()=>{var e;(null==(e=k.value)?void 0:e.length)?de.post("/api/export_by_cases",{cases:k.value},{responseType:"blob"}).then((e=>{const l=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(l),a=document.createElement("a");a.href=t,a.setAttribute("download",g.value.splitReq.split_file_id+".xlsx"),document.body.appendChild(a),a.click()})).catch((()=>{t.error("导出失败")})):t.error("请先生成或添加用例")},ye=()=>{var e;(null==(e=C.value)?void 0:e.length)?de.post("/api/export_by_cases",{cases:C.value},{responseType:"blob"}).then((e=>{const l=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),t=window.URL.createObjectURL(l),a=document.createElement("a");a.href=t,a.setAttribute("download",g.value.req.name+".xlsx"),document.body.appendChild(a),a.click()})).catch((()=>{t.error("导出失败")})):t.error("请先生成或添加用例")};return(e,s)=>{var r,n,o,k,C,B,O,M,A,H,ue,be,we,xe,je,qe,ke,Ce,$e,Re,Ue,Ie,Pe,Be,Te,De,Se,ze;const Fe=b("a-input-search"),Oe=b("a-tree"),Ve=b("a-button"),Le=b("el-table-column"),Me=b("el-table"),Ee=b("a-pagination"),Ae=b("a-select-option"),Ne=b("a-select"),Ke=b("el-button"),Ye=b("a-form-item"),He=b("a-input"),Je=b("a-textarea"),We=b("a-form"),Ge=b("a-drawer");return c(),p("div",Va,[v("div",La,[v("div",Ma,"全部项目 ("+j(m(u).length)+")",1),v("div",Ea,[_(Fe,{placeholder:"请输入要搜索的名称",style:{width:"100%"},onSearch:E})]),v("div",Aa,[_(Oe,{"show-line":!1,"show-icon":!0,"default-expanded-keys":["0-0-0"],"tree-data":J.value,onSelect:le,selectedKeys:h.value,"onUpdate:selectedKeys":s[0]||(s[0]=e=>h.value=e)},{switcherIcon:f((({switcherCls:e})=>[_(m(W),{class:q(e)},null,8,["class"])])),icon:f((e=>["project"===e.type?(c(),w(m(G),{key:0})):y("",!0),"requirement"===e.type?(c(),w(m(Q),{key:1})):"sub_requirement"===e.type?(c(),w(m(X),{key:2})):"split_case"===e.type?(c(),w(m(Z),{key:3})):"testcase"===e.type?(c(),w(m(ee),{key:4})):y("",!0)])),_:1},8,["tree-data","selectedKeys"])])]),v("div",Na,[S(v("div",Ka,[Ya,v("div",Ha,[v("div",Ja,[Wa,x(" "+j(null==(o=null==(n=null==(r=g.value)?void 0:r.project)?void 0:n._id)?void 0:o.$oid),1)]),v("div",Ga,[Qa,x(" "+j(null==(C=null==(k=g.value)?void 0:k.project)?void 0:C.kind),1)]),v("div",Xa,[Za,x(" "+j(null==(O=null==(B=g.value)?void 0:B.project)?void 0:O.period_start)+" 至 "+j(null==(A=null==(M=g.value)?void 0:M.project)?void 0:A.period_end),1)]),v("div",ei,[li,x(" "+j((null==(ue=null==(H=g.value)?void 0:H.project)?void 0:ue.notes)||"无描述"),1)])]),ti,v("div",ai,[_(Ve,{type:"primary",class:"custom-purple-button",size:"large",onClick:ye},{default:f((()=>[x("导出全部")])),_:1})]),_(Me,{data:U.value,style:{width:"100%"},id:"function_point_table"},{default:f((()=>[_(Le,{type:"expand",width:"50"},{default:f((e=>[v("div",ii,[v("div",si,[ri,v("div",null,j(e.row.pre_condition),1)]),v("div",ni,[oi,v("div",null,j(e.row.pre_condition_signal),1)]),v("div",di,[ui,v("div",null,j(e.row.action),1)]),v("div",ci,[pi,v("div",null,j(e.row.action_signal),1)]),v("div",vi,[mi,v("div",null,j(e.row.result),1)]),v("div",_i,[fi,v("div",null,j(e.row.result_signal),1)])])])),_:1}),_(Le,{prop:"testcase_id",label:"测试用例ID",width:te.value/5||100},null,8,["width"]),_(Le,{prop:"testcase_name",label:"测试用例名称",width:te.value/6||100},null,8,["width"]),_(Le,{prop:"version",label:"版本",width:te.value/6||100},null,8,["width"]),_(Le,{prop:"type",label:"用例类型",width:te.value/6||100},{default:f((e=>[x(j("positive"===e.row.type?"正例":"反例"),1)])),_:1},8,["width"]),_(Le,{prop:"is_generalized",label:"是否泛化",width:te.value/6||100},{default:f((e=>[x(j(e.row.is_generalized?"泛化用例":"非泛化用例"),1)])),_:1},8,["width"])])),_:1},8,["data"]),v("div",gi,[_(Ee,{current:R.value,"onUpdate:current":s[1]||(s[1]=e=>R.value=e),total:I.value,"page-size":$.value,onChange:P},null,8,["current","total","page-size"])])],512),[[z,"requirement"===l.value]]),S(v("div",hi,[yi,v("div",bi,[v("div",wi,[xi,x(" "+j(null==(xe=null==(we=null==(be=g.value)?void 0:be.splitReq)?void 0:we.file_name)?void 0:xe.replace(".docx","")),1)]),v("div",ji,[qi,x(" "+j(null==(qe=null==(je=g.value)?void 0:je.splitReq)?void 0:qe.split_file_id),1)]),v("div",ki,[Ci,x(" "+j(null==(Ce=null==(ke=g.value)?void 0:ke.splitReq)?void 0:Ce.version),1)]),v("div",$i,[Ri,x(" "+j((null==(Re=null==($e=g.value)?void 0:$e.splitReq)?void 0:Re.description)||"无描述"),1)])]),Ui,v("div",Ii,[v("div",Pi,[_(Ve,{type:"primary",class:"custom-purple-button",size:"large",onClick:he},{default:f((()=>[x("导出全部")])),_:1})]),_(Me,{data:re.value,style:{width:"100%"},id:"function_point_table",height:ae.value},{default:f((()=>[_(Le,{type:"expand"},{default:f((e=>[v("div",Bi,[v("div",Ti,[Di,v("div",null,j(e.row.pre_condition),1)]),v("div",Si,[zi,v("div",null,j(e.row.pre_condition_signal),1)]),v("div",Fi,[Oi,v("div",null,j(e.row.action),1)]),v("div",Vi,[Li,v("div",null,j(e.row.action_signal),1)]),v("div",Mi,[Ei,v("div",null,j(e.row.result),1)]),v("div",Ai,[Ni,v("div",null,j(e.row.result_signal),1)])])])),_:1}),_(Le,{prop:"testcase_id",label:"测试用例ID",width:te.value/6||100},null,8,["width"]),_(Le,{prop:"testcase_name",label:"测试用例名称",width:te.value/7||100},null,8,["width"]),_(Le,{prop:"version",label:"版本",width:te.value/7||100},null,8,["width"]),_(Le,{prop:"type",label:"用例类型",width:te.value/7||100},{default:f((e=>[x(j("positive"===e.row.type?"正例":"反例"),1)])),_:1},8,["width"]),_(Le,{prop:"status",label:"状态",width:te.value/10||100},{default:f((e=>[x(j(e.row.status?e.row.status:"待操作"),1)])),_:1},8,["width"]),_(Le,{prop:"is_generalized",label:"是否泛化",width:te.value/7||100},{default:f((e=>[x(j(e.row.is_generalized?"泛化用例":"非泛化用例"),1)])),_:1},8,["width"])])),_:1},8,["data","height"]),v("div",Ki,[_(Ee,{current:ie.value,"onUpdate:current":s[2]||(s[2]=e=>ie.value=e),total:ne.value,"page-size":se.value,onChange:oe},null,8,["current","total","page-size"])])])],512),[[z,"sub_requirement"===l.value]]),S(v("div",Yi,[Hi,v("div",Ji,[v("div",Wi,[Gi,x(" "+j(null==(Ie=null==(Ue=g.value)?void 0:Ue.splitCase)?void 0:Ie.testcase_name),1)]),v("div",Qi,[Xi,x(" "+j(null==(Be=null==(Pe=g.value)?void 0:Pe.splitCase)?void 0:Be.testcase_id),1)]),v("div",Zi,[es,x(" "+j(null==(De=null==(Te=g.value)?void 0:Te.splitCase)?void 0:De.version),1)]),v("div",ls,[ts,x(" "+j((null==(ze=null==(Se=g.value)?void 0:Se.splitCase)?void 0:ze.description)||"无描述"),1)])]),as,v("div",is,[v("div",ss,[_(Fe,{placeholder:"请输入测试用例名称",onSearch:N}),_(Ne,{value:K.value,"onUpdate:value":s[3]||(s[3]=e=>K.value=e),style:{width:"12rem","margin-left":"1rem"},placeholder:"请选择测试用例类型"},{default:f((()=>[_(Ae,{value:""},{default:f((()=>[x("全部")])),_:1}),_(Ae,{value:"positive"},{default:f((()=>[x("正例")])),_:1}),_(Ae,{value:"negative"},{default:f((()=>[x("反例")])),_:1})])),_:1},8,["value"])]),v("div",null,[_(Ve,{type:"primary",class:"custom-purple-button",onClick:V,size:"large",style:{"margin-right":"1rem"}},{default:f((()=>[x("批量泛化")])),_:1}),_(Ve,{type:"primary",class:"custom-purple-button",onClick:L,size:"large",style:{"margin-right":"1rem"}},{default:f((()=>[x("批量删除")])),_:1}),_(Ve,{type:"primary",class:"custom-purple-button",size:"large",style:{"margin-right":"1rem"},onClick:ve},{default:f((()=>[x("新建测试用例")])),_:1}),_(Ve,{type:"primary",class:"custom-purple-button",size:"large",onClick:ge},{default:f((()=>[x("导出全部")])),_:1})])]),_(Me,{data:Y.value,style:{width:"100%"},id:"function_point_table",height:ae.value,onSelectionChange:T},{default:f((()=>[_(Le,{type:"expand"},{default:f((e=>[v("div",rs,[v("div",ns,[os,v("div",null,j(e.row.pre_condition),1)]),v("div",ds,[us,v("div",null,j(e.row.pre_condition_signal),1)]),v("div",cs,[ps,v("div",null,j(e.row.action),1)]),v("div",vs,[ms,v("div",null,j(e.row.action_signal),1)]),v("div",_s,[fs,v("div",null,j(e.row.result),1)]),v("div",gs,[hs,v("div",null,j(e.row.result_signal),1)])])])),_:1}),_(Le,{type:"selection",width:"50"}),_(Le,{prop:"testcase_id",label:"测试用例ID",width:te.value/7||100},null,8,["width"]),_(Le,{prop:"testcase_name",label:"测试用例名称",width:te.value/7||100},null,8,["width"]),_(Le,{prop:"version",label:"版本",width:te.value/7||100},null,8,["width"]),_(Le,{prop:"type",label:"用例类型",width:te.value/7||100},{default:f((e=>[x(j("positive"===e.row.type?"正例":"反例"),1)])),_:1},8,["width"]),_(Le,{prop:"is_generalized",label:"是否泛化",width:te.value/7||100},{default:f((e=>[x(j(e.row.is_generalized?"泛化用例":"非泛化用例"),1)])),_:1},8,["width"]),_(Le,{prop:"status",label:"状态",width:te.value/10||100},{default:f((e=>[x(j(e.row.status?e.row.status:"待操作"),1)])),_:1},8,["width"]),_(Le,{label:"操作",width:150},{default:f((e=>[_(Ke,{type:"text",onClick:l=>{return t=e.row,F.value.name=t.testcase_name,F.value.pre_condition=t.pre_condition,F.value.action=t.action,F.value.result=t.result,F.value.pre_condition_signal=t.pre_condition_signal,F.value.action_signal=t.action_signal,F.value.result_signal=t.result_signal,F.value.project_id=g.value.project._id.$oid,F.value.split_file_id=g.value.splitReq.split_file_id,F.value.req_id=g.value.req.req_id,F.value.testcase_id=t.testcase_id,F.value.version=t.version,F.value.type=t.type,void(i.value=!0);var t}},{default:f((()=>[x("修改")])),_:2},1032,["onClick"]),_(Ke,{type:"text",onClick:l=>(e=>{const l={...e,project_id:g.value.project._id.$oid,split_file_id:g.value.splitReq.split_file_id,req_id:g.value.req.req_id,split_case_id:g.value.splitCase.testcase_id};de.post("/api/split_gen_testcase",[l]).then((e=>{"OK"===e.status?(t.success("下发泛化请求成功"),d()):t.error("下发泛化请求失败")}))})(e.row),disabled:e.row.is_generalized},{default:f((()=>[x("泛化")])),_:2},1032,["onClick","disabled"])])),_:1})])),_:1},8,["data","height"])],512),[[z,"split_case"===l.value]]),S(v("div",ys,[_(We,{model:D.value,layout:"vertical"},{default:f((()=>[_(Ye,{label:"测试用例类型"},{default:f((()=>[_(Ne,{value:D.value.type,"onUpdate:value":s[4]||(s[4]=e=>D.value.type=e),placeholder:"请选择测试用例类型"},{default:f((()=>[_(Ae,{value:"positive"},{default:f((()=>[x("正例")])),_:1}),_(Ae,{value:"negative"},{default:f((()=>[x("反例")])),_:1})])),_:1},8,["value"])])),_:1}),_(Ye,{label:"测试用例名称"},{default:f((()=>[_(He,{value:D.value.name,"onUpdate:value":s[5]||(s[5]=e=>D.value.name=e),placeholder:"请输入测试用例名称",rows:4},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件"},{default:f((()=>[_(Je,{value:D.value.pre_condition,"onUpdate:value":s[6]||(s[6]=e=>D.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件信号"},{default:f((()=>[_(He,{value:D.value.pre_condition_signal,"onUpdate:value":s[7]||(s[7]=e=>D.value.pre_condition_signal=e),placeholder:"请输入初始条件信号"},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件"},{default:f((()=>[_(Je,{value:D.value.action,"onUpdate:value":s[8]||(s[8]=e=>D.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件信号"},{default:f((()=>[_(Je,{value:D.value.action_signal,"onUpdate:value":s[9]||(s[9]=e=>D.value.action_signal=e),placeholder:"请输入触发条件信号",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果"},{default:f((()=>[_(Je,{value:D.value.result,"onUpdate:value":s[10]||(s[10]=e=>D.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果信号"},{default:f((()=>[_(Je,{value:D.value.result_signal,"onUpdate:value":s[11]||(s[11]=e=>D.value.result_signal=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,null,{default:f((()=>[v("div",bs,[_(Ve,{type:"primary",onClick:ce,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1}),v("div",ws,"提示：当前为V"+j(D.value.version)+"版本 保存后版本新增",1)])])),_:1})])),_:1},8,["model"])],512),[[z,"testcase"===l.value]]),_(Ge,{title:"修改测试用例",visible:i.value,width:720,onClose:_e},{default:f((()=>[_(We,{model:F.value,layout:"vertical"},{default:f((()=>[_(Ye,{label:"测试用例类型"},{default:f((()=>[_(Ne,{value:F.value.type,"onUpdate:value":s[12]||(s[12]=e=>F.value.type=e),placeholder:"请选择测试用例类型"},{default:f((()=>[_(Ae,{value:"positive"},{default:f((()=>[x("正例")])),_:1}),_(Ae,{value:"negative"},{default:f((()=>[x("反例")])),_:1})])),_:1},8,["value"])])),_:1}),_(Ye,{label:"功能点名称"},{default:f((()=>[_(He,{value:F.value.name,"onUpdate:value":s[13]||(s[13]=e=>F.value.name=e),placeholder:"请输入功能点名称",rows:4},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件"},{default:f((()=>[_(Je,{value:F.value.pre_condition,"onUpdate:value":s[14]||(s[14]=e=>F.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件信号"},{default:f((()=>[_(He,{value:F.value.pre_condition_signal,"onUpdate:value":s[15]||(s[15]=e=>F.value.pre_condition_signal=e),placeholder:"请输入初始条件信号"},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件"},{default:f((()=>[_(Je,{value:F.value.action,"onUpdate:value":s[16]||(s[16]=e=>F.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件信号"},{default:f((()=>[_(Je,{value:F.value.action_signal,"onUpdate:value":s[17]||(s[17]=e=>F.value.action_signal=e),placeholder:"请输入触发条件信号",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果"},{default:f((()=>[_(Je,{value:F.value.result,"onUpdate:value":s[18]||(s[18]=e=>F.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果信号"},{default:f((()=>[_(Je,{value:F.value.result_signal,"onUpdate:value":s[19]||(s[19]=e=>F.value.result_signal=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,null,{default:f((()=>[v("div",xs,[_(Ve,{type:"primary",onClick:pe,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"]),_(Ge,{title:"新建测试用例",visible:a.value,width:720,onClose:me},{default:f((()=>[_(We,{model:F.value,layout:"vertical"},{default:f((()=>[_(Ye,{label:"测试用例类型"},{default:f((()=>[_(Ne,{value:F.value.type,"onUpdate:value":s[20]||(s[20]=e=>F.value.type=e),placeholder:"请选择测试用例类型"},{default:f((()=>[_(Ae,{value:"positive"},{default:f((()=>[x("正例")])),_:1}),_(Ae,{value:"negative"},{default:f((()=>[x("反例")])),_:1})])),_:1},8,["value"])])),_:1}),_(Ye,{label:"测试用例名称"},{default:f((()=>[_(He,{value:F.value.name,"onUpdate:value":s[21]||(s[21]=e=>F.value.name=e),placeholder:"请输入功能点名称",rows:4},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件"},{default:f((()=>[_(Je,{value:F.value.pre_condition,"onUpdate:value":s[22]||(s[22]=e=>F.value.pre_condition=e),placeholder:"请输入初始条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"初始条件信号"},{default:f((()=>[_(He,{value:F.value.pre_condition_signal,"onUpdate:value":s[23]||(s[23]=e=>F.value.pre_condition_signal=e),placeholder:"请输入初始条件信号"},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件"},{default:f((()=>[_(Je,{value:F.value.action,"onUpdate:value":s[24]||(s[24]=e=>F.value.action=e),placeholder:"请输入触发条件",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"触发条件信号"},{default:f((()=>[_(Je,{value:F.value.action_signal,"onUpdate:value":s[25]||(s[25]=e=>F.value.action_signal=e),placeholder:"请输入触发条件信号",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果"},{default:f((()=>[_(Je,{value:F.value.result,"onUpdate:value":s[26]||(s[26]=e=>F.value.result=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,{label:"预期结果信号"},{default:f((()=>[_(Je,{value:F.value.result_signal,"onUpdate:value":s[27]||(s[27]=e=>F.value.result_signal=e),placeholder:"请输入预期结果",rows:2},null,8,["value"])])),_:1}),_(Ye,null,{default:f((()=>[v("div",js,[_(Ve,{type:"primary",onClick:fe,class:"custom-purple-button"},{default:f((()=>[x("保存")])),_:1})])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible"])])])}}}),[["__scopeId","data-v-705588ce"]])}],ks=le({history:te(),routes:qs}),Cs=ae(ke),$s=ie();Cs.use($s),Cs.use(se),Cs.use(ks),Cs.use(re),Cs.mount("#app");
